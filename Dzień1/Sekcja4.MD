### **Zadania praktyczne dla sekcji 4: AWS Compute i Networking (EC2, Lambda, ECS, ELB/ALB)**  

---

#### **Amazon EC2**  
**Uruchomienie instancji EC2 i skonfigurowanie serwera WWW  ***
- Utw√≥rz instancjƒô EC2 w AWS.  
- Skonfiguruj dostƒôp przez Security Group.  
- Zainstaluj i uruchom serwer WWW.  
- Przetestuj dzia≈Çanie serwera przez przeglƒÖdarkƒô.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

### **1. Tworzenie instancji EC2**  
1. Przejd≈∫ do **AWS Management Console** ‚Üí **EC2 Dashboard**.  
2. Kliknij **Launch Instance**.  
3. Wype≈Çnij pola:  
   - **Name**: `WebServerEC2`  
   - **Amazon Machine Image (AMI)**: `Amazon Linux 2`  
   - **Instance Type**: `t3.micro` (Free Tier)  
   - **Key Pair**: Utw√≥rz lub wybierz istniejƒÖcy klucz SSH  
   - **Network Settings**:  
     - **VPC**: Domy≈õlna lub Twoja w≈Çasna  
     - **Subnet**: Wybierz subnet publiczny  
     - **Auto-assign public IP**: **Enabled**  
     - **Security Group**:  
       - Otw√≥rz port **22 (SSH)** ‚Äì dostƒôp tylko dla Twojego IP  
       - Otw√≥rz port **80 (HTTP)** ‚Äì dostƒôp dla wszystkich (`0.0.0.0/0`)  
4. Kliknij **Launch Instance**.  

---

### **2. Po≈ÇƒÖczenie z instancjƒÖ przez SSH**  
1. Wr√≥ƒá do **EC2 Dashboard** ‚Üí **Instances**.  
2. Skopiuj **Public IP** uruchomionej instancji.  
3. Po≈ÇƒÖcz siƒô z instancjƒÖ przez terminal:  
   ```sh
   ssh -i MyKey.pem ec2-user@<public-ip>
   ```

---

### **3. Instalacja i uruchomienie serwera Apache**  
1. Zaktualizuj system:  
   ```sh
   sudo yum update -y
   ```
2. Zainstaluj Apache:  
   ```sh
   sudo yum install httpd -y
   ```
3. Uruchom serwer WWW:  
   ```sh
   sudo systemctl start httpd
   sudo systemctl enable httpd
   ```
4. Dodaj stronƒô testowƒÖ:  
   ```sh
   echo "<h1>Witaj w AWS EC2</h1>" | sudo tee /var/www/html/index.html
   ```
5. Sprawd≈∫ dzia≈Çanie serwera, wpisujƒÖc **Public IP** w przeglƒÖdarce:  
   ```
   http://<public-ip>
   ```
   Je≈õli konfiguracja jest poprawna, zobaczysz komunikat **‚ÄûWitaj w AWS EC2‚Äù**.
</details>
<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

### **1. Tworzenie instancji EC2**
```sh
aws ec2 run-instances \
  --image-id ami-0c55b159cbfafe1f0 \
  --instance-type t3.micro \
  --key-name MyKey \
  --security-groups WebServerSG \
  --tag-specifications 'ResourceType=instance,Tags=[{Key=Name,Value=WebServerEC2}]'
```

### **2. Pobranie publicznego IP instancji**
```sh
aws ec2 describe-instances \
  --filters "Name=tag:Name,Values=WebServerEC2" \
  --query "Reservations[].Instances[].PublicIpAddress" --output text
```

### **3. Po≈ÇƒÖczenie z instancjƒÖ**
```sh
ssh -i MyKey.pem ec2-user@<public-ip>
```

### **4. Instalacja Apache i uruchomienie serwera**
```sh
sudo yum update -y
sudo yum install httpd -y
sudo systemctl start httpd
sudo systemctl enable httpd
echo "<h1>Witaj w AWS EC2</h1>" | sudo tee /var/www/html/index.html
```

### **5. Sprawdzenie dostƒôpno≈õci strony**
```sh
curl http://<public-ip>
```
Je≈õli wynik zwr√≥ci **‚ÄûWitaj w AWS EC2‚Äù**, serwer dzia≈Ça poprawnie.
</details>

#### **AWS Lambda**  
**Tworzenie funkcji AWS Lambda i monitorowanie jej dzia≈Çania za pomocƒÖ AWS X-Ray**
- Utw√≥rz funkcjƒô AWS Lambda w wybranym jƒôzyku programowania.  
- Skonfiguruj jej rolƒô IAM i uprawnienia.  
- W≈ÇƒÖcz AWS X-Ray i skonfiguruj ≈õledzenie ≈ºƒÖda≈Ñ.  
- Wykonaj kilka test√≥w i przeanalizuj dane w X-Ray.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

### **1. Tworzenie funkcji AWS Lambda**
1. Przejd≈∫ do **AWS Management Console** ‚Üí **Lambda**.  
2. Kliknij **Create function**.  
3. Wybierz **Author from scratch** i skonfiguruj:  
   - **Function name**: `LambdaXRayDemo`  
   - **Runtime**: `Python 3.9`  
   - **Execution role**: Utw√≥rz nowƒÖ rolƒô z podstawowymi uprawnieniami (`AWSLambdaBasicExecutionRole`).  
4. Kliknij **Create function**.  

---

### **2. Dodanie kodu funkcji**
1. Przewi≈Ñ do sekcji **Code** i wklej nastƒôpujƒÖcy kod:  
   ```python
   import json
   import time
   import boto3
   from aws_xray_sdk.core import patch_all, xray_recorder

   patch_all()

   def lambda_handler(event, context):
       xray_recorder.begin_segment("LambdaXRaySegment")
       time.sleep(1)  # Symulacja op√≥≈∫nienia
       response = {
           "statusCode": 200,
           "body": json.dumps("Hello from AWS Lambda with X-Ray!")
       }
       xray_recorder.end_segment()
       return response
   ```
2. Kliknij **Deploy**.  

---

### **3. W≈ÇƒÖczenie AWS X-Ray dla funkcji Lambda**
1. Przewi≈Ñ do sekcji **Monitoring tools** ‚Üí **AWS X-Ray tracing**.  
2. Kliknij **Edit** i zaznacz **Active tracing**.  
3. Kliknij **Save**.  

---

### **4. Testowanie funkcji Lambda**
1. Przejd≈∫ do **Test** i utw√≥rz nowy testowy event (mo≈ºe byƒá pusty JSON `{}`).  
2. Kliknij **Test** i zobacz wynik w **Logs**.  

---

### **5. Analiza ≈õledzenia w AWS X-Ray**
1. Przejd≈∫ do **AWS X-Ray** ‚Üí **Traces**.  
2. Wybierz najnowszy ≈õlad i przeanalizuj wykres.  
3. Sprawd≈∫, jak d≈Çugo trwa≈Ço wykonanie funkcji i jakie segmenty by≈Çy monitorowane.  
</details>
<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

### **1. Tworzenie roli IAM dla Lambda**
```sh
aws iam create-role --role-name LambdaXRayRole \
    --assume-role-policy-document '{
        "Version": "2012-10-17",
        "Statement": [{
            "Effect": "Allow",
            "Principal": {"Service": "lambda.amazonaws.com"},
            "Action": "sts:AssumeRole"
        }]
    }'
```

### **2. Przypisanie uprawnie≈Ñ X-Ray do roli**
```sh
aws iam attach-role-policy --role-name LambdaXRayRole \
    --policy-arn arn:aws:iam::aws:policy/AWSXRayDaemonWriteAccess
aws iam attach-role-policy --role-name LambdaXRayRole \
    --policy-arn arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
```

### **3. Tworzenie funkcji Lambda**
```sh
echo 'import json
import time
import boto3
from aws_xray_sdk.core import patch_all, xray_recorder

patch_all()

def lambda_handler(event, context):
    xray_recorder.begin_segment("LambdaXRaySegment")
    time.sleep(1)  # Symulacja op√≥≈∫nienia
    response = {
        "statusCode": 200,
        "body": json.dumps("Hello from AWS Lambda with X-Ray!")
    }
    xray_recorder.end_segment()
    return response' > lambda_function.py

zip function.zip lambda_function.py

aws lambda create-function --function-name LambdaXRayDemo \
    --runtime python3.9 \
    --role arn:aws:iam::<AWS_ACCOUNT_ID>:role/LambdaXRayRole \
    --handler lambda_function.lambda_handler \
    --zip-file fileb://function.zip
```

### **4. W≈ÇƒÖczenie AWS X-Ray dla funkcji Lambda**
```sh
aws lambda update-function-configuration --function-name LambdaXRayDemo \
    --tracing-config Mode=Active
```

### **5. Wywo≈Çanie funkcji Lambda**
```sh
aws lambda invoke --function-name LambdaXRayDemo --payload '{}' response.json
cat response.json
```

### **6. Sprawdzenie ≈õledzenia w AWS X-Ray**
```sh
aws xray get-trace-summaries --start-time $(date -d '5 minutes ago' +%s) --end-time $(date +%s)
```
</details>

#### **Amazon ECS (Elastic Container Service)**  
**Uruchomienie kontenera z Nginx w Amazon ECS (Fargate)**
- Skonfiguruj **klaster ECS** dzia≈ÇajƒÖcy na Fargate.  
- Utw√≥rz **Task Definition**, wykorzystujƒÖc oficjalny obraz **nginx** z Docker Hub.  
- Skonfiguruj **Service**, aby uruchomiƒá aplikacjƒô w Fargate.  
- Sprawd≈∫ dzia≈Çanie aplikacji, wpisujƒÖc adres publiczny Load Balancera lub Taska w przeglƒÖdarce.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

### **1. Tworzenie klastra ECS**
1. Przejd≈∫ do **AWS Management Console** ‚Üí **ECS (Elastic Container Service)**.  
2. Kliknij **Create Cluster**.  
3. Wybierz **Networking only (Fargate)** i kliknij **Next step**.  
4. Nazwij klaster np. `nginx-fargate-cluster`.  
5. Kliknij **Create** i poczekaj na zako≈Ñczenie procesu.  

---

### **2. Tworzenie definicji zadania (Task Definition)**
1. Przejd≈∫ do **Task Definitions** ‚Üí **Create new Task Definition**.  
2. Wybierz **Fargate** jako typ uruchomienia.  
3. W sekcji **Task Definition Name** podaj np. `nginx-fargate-task`.  
4. Wybierz **Operating System Family**: **Linux**.  
5. W sekcji **Task execution role** wybierz istniejƒÖcƒÖ rolƒô **ecsTaskExecutionRole** lub utw√≥rz nowƒÖ.  
6. W sekcji **Container Definitions** kliknij **Add container** i skonfiguruj:  
   - **Container name**: `nginx-container`  
   - **Image**: `nginx` (oficjalny obraz z Docker Hub)  
   - **Port mappings**: `80` ‚Üí `80`  
7. Kliknij **Create**.  

---

### **3. Tworzenie us≈Çugi ECS (Service)**
1. Przejd≈∫ do **ECS Dashboard** ‚Üí **Clusters** ‚Üí `nginx-fargate-cluster`.  
2. Kliknij **Create Service**.  
3. Wybierz:  
   - **Launch Type**: `Fargate`  
   - **Task Definition**: `nginx-fargate-task`  
   - **Cluster**: `nginx-fargate-cluster`  
   - **Service Name**: `nginx-fargate-service`  
   - **Number of Tasks**: `1`  
4. Wybierz istniejƒÖcƒÖ **VPC** i subnety publiczne.  
5. W **Security Group** otw√≥rz port `80` dla wszystkich (`0.0.0.0/0`).  
6. Kliknij **Create Service** i poczekaj na uruchomienie zadania.  

---

### **4. Sprawdzenie dzia≈Çania aplikacji**
1. Przejd≈∫ do **ECS Dashboard** ‚Üí **Clusters** ‚Üí `nginx-fargate-cluster`.  
2. Kliknij w zak≈Çadkƒô **Tasks** i wybierz uruchomiony Task.  
3. Znajd≈∫ **Public IP** kontenera i otw√≥rz go w przeglƒÖdarce:  
   ```
   http://<public-ip>
   ```
4. Je≈õli zobaczysz stronƒô startowƒÖ Nginx, konfiguracja dzia≈Ça poprawnie! üéâ  
</details>
<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

### **1. Tworzenie klastra ECS**
```sh
aws ecs create-cluster --cluster-name nginx-fargate-cluster
```

### **2. Tworzenie definicji zadania ECS**
```sh
aws ecs register-task-definition --family nginx-fargate-task \
  --network-mode awsvpc --requires-compatibilities FARGATE \
  --execution-role-arn arn:aws:iam::<AWS_ACCOUNT_ID>:role/ecsTaskExecutionRole \
  --cpu 256 --memory 512 \
  --container-definitions '[
      {
        "name": "nginx-container",
        "image": "nginx",
        "portMappings": [
          {
            "containerPort": 80,
            "hostPort": 80,
            "protocol": "tcp"
          }
        ]
      }
    ]'
```

### **3. Tworzenie us≈Çugi ECS**
```sh
aws ecs create-service --cluster nginx-fargate-cluster \
  --service-name nginx-fargate-service \
  --task-definition nginx-fargate-task \
  --desired-count 1 --launch-type FARGATE \
  --network-configuration "awsvpcConfiguration={subnets=[subnet-12345678],securityGroups=[sg-12345678],assignPublicIp=ENABLED}"
```

üìå **Zmie≈Ñ `subnet-12345678` oraz `sg-12345678` na odpowiednie warto≈õci dla Twojej VPC i Security Group.**  

### **4. Sprawdzenie statusu us≈Çugi**
```sh
aws ecs describe-services --cluster nginx-fargate-cluster --services nginx-fargate-service
```

### **5. Pobranie publicznego IP kontenera**
```sh
aws ecs list-tasks --cluster nginx-fargate-cluster
TASK_ARN=$(aws ecs list-tasks --cluster nginx-fargate-cluster --query "taskArns[0]" --output text)
aws ecs describe-tasks --cluster nginx-fargate-cluster --tasks $TASK_ARN \
  --query "tasks[].attachments[].details[?name=='networkInterfaceId'].value" --output text
```

**Skopiowany `networkInterfaceId` mo≈ºesz znale≈∫ƒá w AWS Console i sprawdziƒá jego publiczny adres IP.**  

</details>

#### **Elastic Load Balancer (ELB) / Application Load Balancer (ALB)**  
**Tworzenie Load Balancera dla EC2**  
- Utw√≥rz Application Load Balancer (ALB).  
- Skonfiguruj Target Group i dodaj instancje EC2.  
- Utw√≥rz listenera na porcie 80 i skonfiguruj regu≈Çy routingu.  
- Przetestuj dzia≈Çanie Load Balancera, sprawdzajƒÖc dostƒôpno≈õƒá aplikacji.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

### **1. Tworzenie Load Balancera**  
1. Przejd≈∫ do **AWS Management Console** ‚Üí **EC2 Dashboard**.  
2. W menu bocznym wybierz **Load Balancers** ‚Üí Kliknij **Create Load Balancer**.  
3. Wybierz **Application Load Balancer** i kliknij **Create**.  
4. Wype≈Çnij dane Load Balancera:  
   - **Name**: `MyALB`  
   - **Scheme**: `Internet-facing`  
   - **IP address type**: `IPv4`  
   - **VPC**: Wybierz VPC, w kt√≥rej dzia≈ÇajƒÖ instancje EC2.  
   - **Availability Zones**: Wybierz co najmniej 2 subnety publiczne.  

---

### **2. Konfiguracja listenera**  
1. W sekcji **Listeners** ‚Üí **Add Listener**, wybierz:  
   - **Protocol**: `HTTP`  
   - **Port**: `80`  
2. Wybierz **Forward to: New target group**.  

---

### **3. Tworzenie Target Group (Grupy docelowej)**  
1. Nazwij **Target Group**: `MyTargetGroup`.  
2. **Target type**: `Instance`.  
3. **Protocol**: `HTTP`, **Port**: `80`.  
4. **VPC**: Ta sama, w kt√≥rej dzia≈ÇajƒÖ instancje EC2.  
5. Kliknij **Next** i wybierz instancje EC2, kt√≥re majƒÖ obs≈Çugiwaƒá ruch.  
6. Kliknij **Create Target Group**.  

---

### **4. PowiƒÖzanie Load Balancera z Target Group**  
1. Wr√≥ƒá do ekranu konfiguracji ALB.  
2. Wybierz **MyTargetGroup** jako domy≈õlnƒÖ grupƒô docelowƒÖ.  
3. Kliknij **Create Load Balancer**.  

---

### **5. Testowanie Load Balancera**  
1. Przejd≈∫ do **EC2 Dashboard** ‚Üí **Load Balancers**.  
2. Znajd≈∫ **DNS name** Load Balancera i otw√≥rz w przeglƒÖdarce:  
   ```
   http://<DNS-ALB>
   ```
3. Je≈õli zobaczysz stronƒô z jednej z instancji EC2, oznacza to, ≈ºe Load Balancer dzia≈Ça poprawnie.  
</details>
<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

### **1. Tworzenie Load Balancera**  
```sh
aws elbv2 create-load-balancer \
    --name MyALB \
    --type application \
    --scheme internet-facing \
    --subnets subnet-12345678 subnet-87654321 \
    --security-groups sg-12345678
```

### **2. Tworzenie Target Group**  
```sh
aws elbv2 create-target-group \
    --name MyTargetGroup \
    --protocol HTTP \
    --port 80 \
    --vpc-id vpc-12345678
```

### **3. Rejestracja instancji EC2 do Target Group**  
```sh
aws elbv2 register-targets \
    --target-group-arn arn:aws:elasticloadbalancing:region:account-id:targetgroup/MyTargetGroup/1234567890abcdef \
    --targets Id=i-12345678 Id=i-87654321
```

### **4. Tworzenie Listenera dla Load Balancera**  
```sh
aws elbv2 create-listener \
    --load-balancer-arn arn:aws:elasticloadbalancing:region:account-id:loadbalancer/app/MyALB/abcdef1234567890 \
    --protocol HTTP --port 80 \
    --default-actions Type=forward,TargetGroupArn=arn:aws:elasticloadbalancing:region:account-id:targetgroup/MyTargetGroup/1234567890abcdef
```

### **5. Pobranie adresu DNS Load Balancera**
```sh
aws elbv2 describe-load-balancers \
    --names MyALB \
    --query "LoadBalancers[0].DNSName"
```

### **6. Testowanie Load Balancera**
Otw√≥rz przeglƒÖdarkƒô i wpisz zwr√≥cony **DNS Load Balancera**:
```
http://<DNS-ALB>
```
</details>