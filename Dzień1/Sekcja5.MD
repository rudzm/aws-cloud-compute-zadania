### **Zadania praktyczne dla sekcji 5: AWS Lambda**  

---

**Tworzenie i uruchomienie prostej funkcji Lambda**  
StwÃ³rz funkcjÄ™ AWS Lambda w dowolnym jÄ™zyku obsÅ‚ugiwanym przez AWS Lambda. Funkcja powinna zwracaÄ‡ prostÄ… odpowiedÅº w formacie JSON. Wykonaj test lokalny w konsoli AWS i sprawdÅº wynik.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

### **1. Tworzenie funkcji Lambda**  
1. PrzejdÅº do **AWS Management Console** â†’ **Lambda**.  
2. Kliknij **Create function**.  
3. Wybierz **Author from scratch**.  
4. WypeÅ‚nij pola:  
   - **Function name**: `MyFirstLambda`  
   - **Runtime**: `Python 3.9`  
   - **Execution role**: Wybierz **Create a new role with basic Lambda permissions**  
5. Kliknij **Create function**.  

---

### **2. Edycja kodu funkcji Lambda**  
1. PrzewiÅ„ do sekcji **Code**.  
2. Wklej poniÅ¼szy kod w edytorze:  

   ```python
   import json

   def lambda_handler(event, context):
       return {
           "statusCode": 200,
           "body": json.dumps("Hello from AWS Lambda!")
       }
   ```
3. Kliknij **Deploy**.  

---

### **3. Testowanie funkcji Lambda**  
1. Kliknij **Test** â†’ **Create a new test event**.  
2. Wpisz **Event name**: `TestEvent`.  
3. W polu **Event JSON** wklej `{}` (pusty event).  
4. Kliknij **Create** â†’ **Test**.  
5. SprawdÅº, czy odpowiedÅº zawiera:  
   ```json
   {
       "statusCode": 200,
       "body": "\"Hello from AWS Lambda!\""
   }
   ```
6. PrzejdÅº do zakÅ‚adki **Monitor** â†’ **View logs in CloudWatch**, aby sprawdziÄ‡ logi funkcji.  
</details>
<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

### **1. Tworzenie roli IAM dla AWS Lambda**  
Lambda wymaga roli IAM do dziaÅ‚ania. Tworzymy nowÄ… rolÄ™ z podstawowymi uprawnieniami:  

```sh
aws iam create-role --role-name LambdaBasicExecutionRole \
    --assume-role-policy-document '{
        "Version": "2012-10-17",
        "Statement": [{
            "Effect": "Allow",
            "Principal": {"Service": "lambda.amazonaws.com"},
            "Action": "sts:AssumeRole"
        }]
    }'
```

NastÄ™pnie przypisujemy politykÄ™ pozwalajÄ…cÄ… na zapis logÃ³w do CloudWatch:  

```sh
aws iam attach-role-policy --role-name LambdaBasicExecutionRole \
    --policy-arn arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
```

---

### **2. Tworzenie pliku z kodem funkcji Lambda**  
UtwÃ³rz plik `lambda_function.py` i dodaj kod funkcji:  

```sh
echo 'import json

def lambda_handler(event, context):
    return {
        "statusCode": 200,
        "body": json.dumps("Hello from AWS Lambda!")
    }' > lambda_function.py
```

---

### **3. Pakowanie kodu do pliku ZIP**  
```sh
zip function.zip lambda_function.py
```

---

### **4. Pobranie ARN roli IAM**  
```sh
aws iam get-role --role-name LambdaBasicExecutionRole --query 'Role.Arn' --output text
```

Skopiuj **ARN** roli i uÅ¼yj go w nastÄ™pnym kroku.

---

### **5. Tworzenie funkcji Lambda**  
ZastÄ…p `<ARN_ROLI>` wartoÅ›ciÄ… uzyskanÄ… w poprzednim kroku:  

```sh
aws lambda create-function --function-name MyFirstLambda \
    --runtime python3.9 \
    --role <ARN_ROLI> \
    --handler lambda_function.lambda_handler \
    --zip-file fileb://function.zip
```

---

### **6. WywoÅ‚anie funkcji Lambda**  
```sh
aws lambda invoke --function-name MyFirstLambda --payload '{}' response.json
```

SprawdÅº wynik:  
```sh
cat response.json
```

Oczekiwany wynik:  
```json
{
    "statusCode": 200,
    "body": "\"Hello from AWS Lambda!\""
}
```

---

### **7. Sprawdzenie logÃ³w w CloudWatch**  
```sh
aws logs describe-log-groups --log-group-name-prefix "/aws/lambda/MyFirstLambda"
aws logs tail "/aws/lambda/MyFirstLambda" --follow
```
</details>

**Tworzenie funkcji Lambda wywoÅ‚ywanej przez Amazon S3**   
Skonfiguruj funkcjÄ™ Lambda tak, aby byÅ‚a automatycznie wywoÅ‚ywana w momencie przesÅ‚ania nowego pliku do okreÅ›lonego bucketa Amazon S3. Funkcja powinna odczytaÄ‡ metadane pliku i zapisaÄ‡ je w logach CloudWatch.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

### **1. Tworzenie bucketa S3**
1. PrzejdÅº do **AWS Management Console** â†’ **S3**.  
2. Kliknij **Create bucket**.  
3. Wpisz unikalnÄ… nazwÄ™ bucketa, np. `lambda-s3-trigger-demo-<unikalny-id>`.  
4. Wybierz region, np. `us-east-1`.  
5. **WyÅ‚Ä…cz opcjÄ™ blokowania dostÄ™pu publicznego** (nie bÄ™dzie potrzebne dla tego zadania).  
6. Kliknij **Create bucket**.  

---

### **2. Tworzenie funkcji Lambda**
1. PrzejdÅº do **AWS Management Console** â†’ **Lambda**.  
2. Kliknij **Create function**.  
3. Wybierz **Author from scratch**.  
4. WypeÅ‚nij dane:  
   - **Function name**: `S3TriggerLambda`  
   - **Runtime**: `Python 3.9`  
   - **Execution role**: **Create a new role with basic Lambda permissions**  
5. Kliknij **Create function**.  

---

### **3. Edycja kodu funkcji Lambda**
1. W sekcji **Code** wklej nastÄ™pujÄ…cy kod:  

   ```python
   import json
   import boto3

   def lambda_handler(event, context):
       s3 = boto3.client("s3")
       for record in event["Records"]:
           bucket_name = record["s3"]["bucket"]["name"]
           file_name = record["s3"]["object"]["key"]
           print(f"Nowy plik przesÅ‚any: {file_name} do bucketu: {bucket_name}")
       return {
           "statusCode": 200,
           "body": json.dumps("S3 event processed successfully!")
       }
   ```
2. Kliknij **Deploy**.  

---

### **4. Dodanie wyzwalacza S3 do funkcji Lambda**
1. PrzejdÅº do zakÅ‚adki **Configuration** â†’ **Triggers**.  
2. Kliknij **Add Trigger**.  
3. Wybierz **S3** jako ÅºrÃ³dÅ‚o wyzwalania.  
4. Wybierz bucket utworzony w kroku 1.  
5. W sekcji **Event type** wybierz **PUT** (nowe przesÅ‚ane pliki).  
6. Kliknij **Add**.  

ðŸ“Œ **Teraz kaÅ¼da operacja przesÅ‚ania pliku do S3 uruchomi funkcjÄ™ Lambda!**  

---

### **5. Testowanie funkcji**
1. PrzejdÅº do **S3** â†’ OtwÃ³rz swÃ³j bucket.  
2. Kliknij **Upload**, wybierz dowolny plik i przeÅ›lij go.  
3. PrzejdÅº do **AWS Lambda** â†’ **Monitor** â†’ **View logs in CloudWatch**.  
4. SprawdÅº, czy w logach pojawiÅ‚a siÄ™ informacja o nowym pliku.
</details>
<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

### **1. Tworzenie bucketa S3**
```sh
aws s3 mb s3://lambda-s3-trigger-demo-<unikalny-id>
```

---

### **2. Tworzenie roli IAM dla AWS Lambda**
```sh
aws iam create-role --role-name LambdaS3ExecutionRole \
    --assume-role-policy-document '{
        "Version": "2012-10-17",
        "Statement": [{
            "Effect": "Allow",
            "Principal": {"Service": "lambda.amazonaws.com"},
            "Action": "sts:AssumeRole"
        }]
    }'
```
Przypisanie polityki pozwalajÄ…cej Lambda na odczyt z S3 i zapis logÃ³w w CloudWatch:
```sh
aws iam attach-role-policy --role-name LambdaS3ExecutionRole \
    --policy-arn arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole

aws iam attach-role-policy --role-name LambdaS3ExecutionRole \
    --policy-arn arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess
```

---

### **3. Tworzenie pliku funkcji Lambda**
```sh
echo 'import json
import boto3

def lambda_handler(event, context):
    s3 = boto3.client("s3")
    for record in event["Records"]:
        bucket_name = record["s3"]["bucket"]["name"]
        file_name = record["s3"]["object"]["key"]
        print(f"Nowy plik przesÅ‚any: {file_name} do bucketu: {bucket_name}")
    return {
        "statusCode": 200,
        "body": json.dumps("S3 event processed successfully!")
    }' > lambda_function.py
```

Spakowanie pliku ZIP:
```sh
zip function.zip lambda_function.py
```

---

### **4. Pobranie ARN roli IAM**
```sh
aws iam get-role --role-name LambdaS3ExecutionRole --query 'Role.Arn' --output text
```

---

### **5. Tworzenie funkcji Lambda**
ZastÄ…p `<ARN_ROLI>` uzyskanÄ… wartoÅ›ciÄ…:
```sh
aws lambda create-function --function-name S3TriggerLambda \
    --runtime python3.9 \
    --role <ARN_ROLI> \
    --handler lambda_function.lambda_handler \
    --zip-file fileb://function.zip
```

---

### **6. Konfiguracja wyzwalacza S3 dla funkcji Lambda**
ZastÄ…p `<BUCKET_NAME>` nazwÄ… swojego bucketa:
```sh
aws s3api put-bucket-notification-configuration --bucket <BUCKET_NAME> --notification-configuration '{
    "LambdaFunctionConfigurations": [{
        "LambdaFunctionArn": "'$(aws lambda get-function --function-name S3TriggerLambda --query "Configuration.FunctionArn" --output text)'",
        "Events": ["s3:ObjectCreated:*"]
    }]
}'
```

---

### **7. Testowanie funkcji Lambda**  
PrzeÅ›lij testowy plik do S3:
```sh
aws s3 cp testfile.txt s3://lambda-s3-trigger-demo-<unikalny-id>/
```
SprawdÅº logi w CloudWatch:
```sh
aws logs describe-log-groups --log-group-name-prefix "/aws/lambda/S3TriggerLambda"
aws logs tail "/aws/lambda/S3TriggerLambda" --follow
```
</details>

---


**Analiza logÃ³w funkcji Lambda w Amazon CloudWatch**  
Uruchom funkcjÄ™ AWS Lambda kilka razy i przeanalizuj jej logi w Amazon CloudWatch. Zidentyfikuj czas wykonania oraz ewentualne bÅ‚Ä™dy.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

### **1. Tworzenie funkcji Lambda**  
1. PrzejdÅº do **AWS Management Console** â†’ **Lambda**.  
2. Kliknij **Create function**.  
3. Wybierz **Author from scratch**.  
4. WypeÅ‚nij dane:  
   - **Function name**: `LambdaLoggingDemo`  
   - **Runtime**: `Python 3.9`  
   - **Execution role**: **Create a new role with basic Lambda permissions**  
5. Kliknij **Create function**.  

---

### **2. Edycja kodu funkcji Lambda**  
1. PrzejdÅº do sekcji **Code** i wklej nastÄ™pujÄ…cy kod:  

   ```python
   import json
   import logging

   # Konfiguracja loggera
   logger = logging.getLogger()
   logger.setLevel(logging.INFO)

   def lambda_handler(event, context):
       logger.info("Funkcja Lambda zostaÅ‚a uruchomiona.")
       logger.warning("To jest ostrzeÅ¼enie!")
       logger.error("To jest komunikat o bÅ‚Ä™dzie!")

       return {
           "statusCode": 200,
           "body": json.dumps("Logowanie w CloudWatch dziaÅ‚a poprawnie!")
       }
   ```
2. Kliknij **Deploy**.  

---

### **3. Uruchomienie funkcji i generowanie logÃ³w**  
1. Kliknij **Test** â†’ **Create a new test event**.  
2. Wpisz **Event name**: `TestEvent`.  
3. W polu **Event JSON** wklej `{}` (pusty event).  
4. Kliknij **Create** â†’ **Test**, aby uruchomiÄ‡ funkcjÄ™ kilka razy.  

---

### **4. Analiza logÃ³w w Amazon CloudWatch**  
1. PrzejdÅº do zakÅ‚adki **Monitor** â†’ **View logs in CloudWatch**.  
2. ZnajdÅº grupÄ™ logÃ³w `/aws/lambda/LambdaLoggingDemo` i kliknij w niÄ….  
3. Przejrzyj logi, sprawdzajÄ…c, czy pojawiÅ‚y siÄ™ wpisy INFO, WARNING i ERROR.  
4. Zidentyfikuj timestampy oraz ewentualne bÅ‚Ä™dy.  
</details>
<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

### **1. Tworzenie roli IAM dla AWS Lambda**  
Lambda wymaga roli IAM do dziaÅ‚ania. Tworzymy nowÄ… rolÄ™ z podstawowymi uprawnieniami:  

```sh
aws iam create-role --role-name LambdaLoggingExecutionRole \
    --assume-role-policy-document '{
        "Version": "2012-10-17",
        "Statement": [{
            "Effect": "Allow",
            "Principal": {"Service": "lambda.amazonaws.com"},
            "Action": "sts:AssumeRole"
        }]
    }'
```

Przypisujemy politykÄ™ pozwalajÄ…cÄ… na zapis logÃ³w do CloudWatch:  

```sh
aws iam attach-role-policy --role-name LambdaLoggingExecutionRole \
    --policy-arn arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
```

---

### **2. Tworzenie pliku funkcji Lambda**  
```sh
echo 'import json
import logging

logger = logging.getLogger()
logger.setLevel(logging.INFO)

def lambda_handler(event, context):
    logger.info("Funkcja Lambda zostaÅ‚a uruchomiona.")
    logger.warning("To jest ostrzeÅ¼enie!")
    logger.error("To jest komunikat o bÅ‚Ä™dzie!")

    return {
        "statusCode": 200,
        "body": json.dumps("Logowanie w CloudWatch dziaÅ‚a poprawnie!")
    }' > lambda_function.py
```

Spakowanie pliku ZIP:  
```sh
zip function.zip lambda_function.py
```

---

### **3. Pobranie ARN roli IAM**  
```sh
aws iam get-role --role-name LambdaLoggingExecutionRole --query 'Role.Arn' --output text
```

---

### **4. Tworzenie funkcji Lambda**  
ZastÄ…p `<ARN_ROLI>` uzyskanÄ… wartoÅ›ciÄ…:  
```sh
aws lambda create-function --function-name LambdaLoggingDemo \
    --runtime python3.9 \
    --role <ARN_ROLI> \
    --handler lambda_function.lambda_handler \
    --zip-file fileb://function.zip
```

---

### **5. WywoÅ‚anie funkcji Lambda i generowanie logÃ³w**  
```sh
aws lambda invoke --function-name LambdaLoggingDemo --payload '{}' response.json
```

Sprawdzenie odpowiedzi:  
```sh
cat response.json
```

---

### **6. Sprawdzenie logÃ³w w CloudWatch**  
Wylistowanie grup logÃ³w:  
```sh
aws logs describe-log-groups --log-group-name-prefix "/aws/lambda/LambdaLoggingDemo"
```

Pobranie najnowszych logÃ³w funkcji Lambda:  
```sh
aws logs tail "/aws/lambda/LambdaLoggingDemo" --follow
```
</details>

---


**Wyzwalanie AWS Lambda za pomocÄ… Amazon SNS**   
Skonfiguruj Amazon SNS tak, aby wiadomoÅ›ci publikowane w temacie SNS automatycznie wywoÅ‚ywaÅ‚y funkcjÄ™ Lambda. SprawdÅº, czy funkcja poprawnie przetwarza otrzymane wiadomoÅ›ci.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

### **1. Tworzenie tematu SNS**
1. PrzejdÅº do **AWS Management Console** â†’ **Amazon SNS**.  
2. Kliknij **Topics** â†’ **Create topic**.  
3. Wybierz **Standard** jako typ tematu.  
4. Wpisz **Name**: `LambdaSNSTopic`  
5. Kliknij **Create topic**.  
6. Skopiuj **Topic ARN** â€“ bÄ™dzie potrzebny pÃ³Åºniej.  

---

### **2. Tworzenie funkcji Lambda**
1. PrzejdÅº do **AWS Management Console** â†’ **Lambda**.  
2. Kliknij **Create function**.  
3. Wybierz **Author from scratch**.  
4. WypeÅ‚nij dane:  
   - **Function name**: `SNSLambdaHandler`  
   - **Runtime**: `Python 3.9`  
   - **Execution role**: **Create a new role with basic Lambda permissions**  
5. Kliknij **Create function**.  

---

### **3. Edycja kodu funkcji Lambda**
1. PrzejdÅº do sekcji **Code** i wklej nastÄ™pujÄ…cy kod:  

   ```python
   import json

   def lambda_handler(event, context):
       for record in event["Records"]:
           message = record["Sns"]["Message"]
           print(f"Otrzymano wiadomoÅ›Ä‡ z SNS: {message}")

       return {
           "statusCode": 200,
           "body": json.dumps("SNS event processed successfully!")
       }
   ```
2. Kliknij **Deploy**.  

---

### **4. PowiÄ…zanie SNS z funkcjÄ… Lambda**
1. PrzejdÅº do zakÅ‚adki **Configuration** â†’ **Triggers**.  
2. Kliknij **Add Trigger**.  
3. Wybierz **SNS** jako ÅºrÃ³dÅ‚o wyzwalania.  
4. Wybierz utworzony wczeÅ›niej temat **LambdaSNSTopic**.  
5. Kliknij **Add**.  

ðŸ“Œ **Teraz kaÅ¼da wiadomoÅ›Ä‡ wysÅ‚ana do SNS wywoÅ‚a funkcjÄ™ Lambda!**  

---

### **5. Testowanie SNS i Lambda**
1. PrzejdÅº do **Amazon SNS** â†’ **LambdaSNSTopic** â†’ **Publish message**.  
2. Wpisz dowolny tekst w **Message body** i kliknij **Publish message**.  
3. PrzejdÅº do **AWS Lambda** â†’ **Monitor** â†’ **View logs in CloudWatch**.  
4. SprawdÅº logi funkcji Lambda, powinny zawieraÄ‡ otrzymanÄ… wiadomoÅ›Ä‡ z SNS.  
</details>
<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

### **1. Tworzenie tematu SNS**
```sh
aws sns create-topic --name LambdaSNSTopic
```
Skopiuj zwrÃ³cony `TopicArn`.

---

### **2. Tworzenie roli IAM dla AWS Lambda**
```sh
aws iam create-role --role-name LambdaSNSExecutionRole \
    --assume-role-policy-document '{
        "Version": "2012-10-17",
        "Statement": [{
            "Effect": "Allow",
            "Principal": {"Service": "lambda.amazonaws.com"},
            "Action": "sts:AssumeRole"
        }]
    }'
```
Przypisujemy politykÄ™ pozwalajÄ…cÄ… na zapis logÃ³w do CloudWatch:  

```sh
aws iam attach-role-policy --role-name LambdaSNSExecutionRole \
    --policy-arn arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
```

---

### **3. Tworzenie pliku funkcji Lambda**
```sh
echo 'import json

def lambda_handler(event, context):
    for record in event["Records"]:
        message = record["Sns"]["Message"]
        print(f"Otrzymano wiadomoÅ›Ä‡ z SNS: {message}")

    return {
        "statusCode": 200,
        "body": json.dumps("SNS event processed successfully!")
    }' > lambda_function.py
```

Spakowanie pliku ZIP:  
```sh
zip function.zip lambda_function.py
```

---

### **4. Pobranie ARN roli IAM**
```sh
aws iam get-role --role-name LambdaSNSExecutionRole --query 'Role.Arn' --output text
```

---

### **5. Tworzenie funkcji Lambda**
ZastÄ…p `<ARN_ROLI>` uzyskanÄ… wartoÅ›ciÄ…:  
```sh
aws lambda create-function --function-name SNSLambdaHandler \
    --runtime python3.9 \
    --role <ARN_ROLI> \
    --handler lambda_function.lambda_handler \
    --zip-file fileb://function.zip
```

---

### **6. Subskrypcja Lambda do tematu SNS**
ZastÄ…p `<TOPIC_ARN>` wartoÅ›ciÄ… zwrÃ³conÄ… w kroku 1:
```sh
aws sns subscribe --topic-arn <TOPIC_ARN> \
    --protocol lambda \
    --notification-endpoint $(aws lambda get-function --function-name SNSLambdaHandler --query "Configuration.FunctionArn" --output text)
```

### **7. Zezwolenie SNS na wywoÅ‚anie Lambda**
```sh
aws lambda add-permission --function-name SNSLambdaHandler \
    --statement-id sns-permission \
    --action "lambda:InvokeFunction" \
    --principal sns.amazonaws.com \
    --source-arn <TOPIC_ARN>
```

---

Publikowanie wiadomoÅ›ci do SNS:
```sh
aws sns publish --topic-arn <TOPIC_ARN> --message "Testowa wiadomoÅ›Ä‡ dla Lambda!"
```

Sprawdzenie logÃ³w w CloudWatch:
```sh
aws logs describe-log-groups --log-group-name-prefix "/aws/lambda/SNSLambdaHandler"
aws logs tail "/aws/lambda/SNSLambdaHandler" --follow
```
</details>

**Automatyczne przetwarzanie wiadomoÅ›ci z Amazon SQS przez AWS Lambda**   
StwÃ³rz kolejkÄ™ Amazon SQS i skonfiguruj AWS Lambda do automatycznego przetwarzania wiadomoÅ›ci. Upewnij siÄ™, Å¼e wiadomoÅ›ci sÄ… odbierane i poprawnie logowane przez funkcjÄ™.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

### **1. Tworzenie kolejki SQS**
1. PrzejdÅº do **AWS Management Console** â†’ **Amazon SQS**.  
2. Kliknij **Create queue**.  
3. Wybierz **Standard queue**.  
4. Wpisz **Name**: `LambdaSQSQueue`.  
5. W sekcji **Access policy** wybierz **Advanced** i dodaj uprawnienia dla Lambda (moÅ¼na je takÅ¼e dodaÄ‡ pÃ³Åºniej).  
6. Kliknij **Create queue**.  
7. Skopiuj **Queue URL** i **Queue ARN** â€“ bÄ™dÄ… potrzebne pÃ³Åºniej.  

---

### **2. Tworzenie funkcji Lambda**
1. PrzejdÅº do **AWS Management Console** â†’ **Lambda**.  
2. Kliknij **Create function**.  
3. Wybierz **Author from scratch**.  
4. WypeÅ‚nij dane:  
   - **Function name**: `SQSProcessorLambda`  
   - **Runtime**: `Python 3.9`  
   - **Execution role**: **Create a new role with basic Lambda permissions**  
5. Kliknij **Create function**.  

---

### **3. Edycja kodu funkcji Lambda**
1. W sekcji **Code** wklej nastÄ™pujÄ…cy kod:  

   ```python
   import json

   def lambda_handler(event, context):
       for record in event["Records"]:
           message_body = record["body"]
           print(f"Otrzymano wiadomoÅ›Ä‡ z SQS: {message_body}")

       return {
           "statusCode": 200,
           "body": json.dumps("SQS message processed successfully!")
       }
   ```
2. Kliknij **Deploy**.  

---

### **4. PowiÄ…zanie SQS z funkcjÄ… Lambda**
1. PrzejdÅº do zakÅ‚adki **Configuration** â†’ **Triggers**.  
2. Kliknij **Add Trigger**.  
3. Wybierz **SQS** jako ÅºrÃ³dÅ‚o wyzwalania.  
4. Wybierz utworzonÄ… wczeÅ›niej kolejkÄ™ **LambdaSQSQueue**.  
5. Kliknij **Add**.  

---

### **5. Testowanie SQS i Lambda**
1. PrzejdÅº do **Amazon SQS** â†’ **LambdaSQSQueue** â†’ **Send and receive messages**.  
2. Wpisz przykÅ‚adowÄ… wiadomoÅ›Ä‡, np. `"Testowa wiadomoÅ›Ä‡ dla Lambda"` i kliknij **Send message**.  
3. PrzejdÅº do **AWS Lambda** â†’ **Monitor** â†’ **View logs in CloudWatch**.  
4. SprawdÅº logi funkcji Lambda, powinny zawieraÄ‡ otrzymanÄ… wiadomoÅ›Ä‡ z SQS.
</details>
<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

### **1. Tworzenie kolejki SQS**
```sh
aws sqs create-queue --queue-name LambdaSQSQueue
```
Pobierz ARN kolejki:
```sh
aws sqs get-queue-attributes --queue-url $(aws sqs get-queue-url --queue-name LambdaSQSQueue --query "QueueUrl" --output text) --attribute-name QueueArn
```
Skopiuj wartoÅ›Ä‡ `QueueArn`.

---

### **2. Tworzenie roli IAM dla AWS Lambda**
```sh
aws iam create-role --role-name LambdaSQSExecutionRole \
    --assume-role-policy-document '{
        "Version": "2012-10-17",
        "Statement": [{
            "Effect": "Allow",
            "Principal": {"Service": "lambda.amazonaws.com"},
            "Action": "sts:AssumeRole"
        }]
    }'
```
Przypisujemy polityki:
```sh
aws iam attach-role-policy --role-name LambdaSQSExecutionRole \
    --policy-arn arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole

aws iam attach-role-policy --role-name LambdaSQSExecutionRole \
    --policy-arn arn:aws:iam::aws:policy/AmazonSQSFullAccess
```

---

### **3. Tworzenie pliku funkcji Lambda**
```sh
echo 'import json

def lambda_handler(event, context):
    for record in event["Records"]:
        message_body = record["body"]
        print(f"Otrzymano wiadomoÅ›Ä‡ z SQS: {message_body}")

    return {
        "statusCode": 200,
        "body": json.dumps("SQS message processed successfully!")
    }' > lambda_function.py
```

Spakowanie pliku ZIP:  
```sh
zip function.zip lambda_function.py
```

---

### **4. Pobranie ARN roli IAM**
```sh
aws iam get-role --role-name LambdaSQSExecutionRole --query 'Role.Arn' --output text
```

---

### **5. Tworzenie funkcji Lambda**
ZastÄ…p `<ARN_ROLI>` uzyskanÄ… wartoÅ›ciÄ…:  
```sh
aws lambda create-function --function-name SQSProcessorLambda \
    --runtime python3.9 \
    --role <ARN_ROLI> \
    --handler lambda_function.lambda_handler \
    --zip-file fileb://function.zip
```

---

### **6. PowiÄ…zanie kolejki SQS z funkcjÄ… Lambda**
ZastÄ…p `<QUEUE_ARN>` wartoÅ›ciÄ… zwrÃ³conÄ… w kroku 1:
```sh
aws lambda create-event-source-mapping \
    --function-name SQSProcessorLambda \
    --batch-size 10 \
    --event-source-arn <QUEUE_ARN>
```

---

### **7. Testowanie SQS i Lambda**  
Publikowanie wiadomoÅ›ci do SQS:
```sh
aws sqs send-message --queue-url $(aws sqs get-queue-url --queue-name LambdaSQSQueue --query "QueueUrl" --output text) --message-body "Testowa wiadomoÅ›Ä‡ dla Lambda!"
```

Sprawdzenie logÃ³w w CloudWatch:
```sh
aws logs describe-log-groups --log-group-name-prefix "/aws/lambda/SQSProcessorLambda"
aws logs tail "/aws/lambda/SQSProcessorLambda" --follow
```
</details>

---


