## **Zadania praktyczne dla sekcji 2: AWS ECR** 

## **1. Tworzenie prywatnego repozytorium w ECR**  
- UtwÃ³rz nowe **prywatne** repozytorium w Amazon ECR.  
- Skonfiguruj uprawnienia, aby tylko okreÅ›lone role IAM mogÅ‚y przesyÅ‚aÄ‡ obrazy.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

**1. Tworzenie prywatnego repozytorium ECR**  
1. PrzejdÅº do **AWS Management Console** â†’ **Amazon ECR**.  
2. Kliknij **Create repository**.  
3. W sekcji **Visibility settings** wybierz **Private** (domyÅ›lne ustawienie).  
4. Wpisz **Repository name**: `my-private-repo`.  
5. W sekcji **Tag immutability** (opcjonalnie):  
   - Wybierz **Enabled**, aby zapobiec nadpisywaniu istniejÄ…cych tagÃ³w obrazÃ³w.  
6. W sekcji **Scan on push** (opcjonalnie):  
   - Wybierz **Enhanced scanning**, jeÅ›li chcesz, aby AWS skanowaÅ‚ obrazy w poszukiwaniu podatnoÅ›ci.  
7. Kliknij **Create repository**.  

ğŸ“Œ **Repozytorium `my-private-repo` zostaÅ‚o utworzone!** ğŸ‰  

---

**2. Konfiguracja uprawnieÅ„ dostÄ™pu do repozytorium**  
1. PrzejdÅº do zakÅ‚adki **Permissions** w repozytorium `my-private-repo`.  
2. Kliknij **Edit policy**.  
3. Wklej nastÄ™pujÄ…cÄ… politykÄ™ (przykÅ‚ad nadania uprawnieÅ„ uÅ¼ytkownikowi IAM):  

   ```json
   {
       "Version": "2012-10-17",
       "Statement": [
           {
               "Effect": "Allow",
               "Principal": {
                   "AWS": "arn:aws:iam::<AWS_ACCOUNT_ID>:user/dev-user"
               },
               "Action": [
                   "ecr:BatchGetImage",
                   "ecr:GetDownloadUrlForLayer"
               ]
           }
       ]
   }
   ```
4. Kliknij **Save policy**.  
</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

**1. Tworzenie prywatnego repozytorium**  
```sh
aws ecr create-repository --repository-name my-private-repo
```
PrzykÅ‚adowa odpowiedÅº:  
```json
{
    "repository": {
        "repositoryArn": "arn:aws:ecr:us-east-1:123456789012:repository/my-private-repo",
        "repositoryName": "my-private-repo",
        "repositoryUri": "123456789012.dkr.ecr.us-east-1.amazonaws.com/my-private-repo"
    }
}
```
ğŸ“Œ **Zapisz `repositoryUri`, poniewaÅ¼ bÄ™dzie potrzebne do wysyÅ‚ania i pobierania obrazÃ³w Docker.**  

---

**2. Konfiguracja uprawnieÅ„ do repozytorium**  
ğŸ“Œ Nadanie uprawnieÅ„ uÅ¼ytkownikowi `dev-user`, aby mÃ³gÅ‚ pobieraÄ‡ obrazy:  
```sh
aws ecr set-repository-policy \
    --repository-name my-private-repo \
    --policy-text '{
        "Version": "2012-10-17",
        "Statement": [
            {
                "Effect": "Allow",
                "Principal": {
                    "AWS": "arn:aws:iam::<AWS_ACCOUNT_ID>:user/dev-user"
                },
                "Action": [
                    "ecr:BatchGetImage",
                    "ecr:GetDownloadUrlForLayer"
                ]
            }
        ]
    }'
```
ğŸ“Œ **Teraz uÅ¼ytkownik `dev-user` ma dostÄ™p do repozytorium!**  

---

**3. Sprawdzenie listy repozytoriÃ³w**  
Aby upewniÄ‡ siÄ™, Å¼e repozytorium zostaÅ‚o utworzone, wykonaj:  
```sh
aws ecr describe-repositories
```
</details>

---

## **2. Tworzenie publicznego repozytorium w ECR**  
- UtwÃ³rz **publiczne** repozytorium w Amazon ECR.  
- Przetestuj dostÄ™pnoÅ›Ä‡ repozytorium i sprawdÅº, czy moÅ¼na pobraÄ‡ obraz bez uwierzytelniania.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

**1. Tworzenie publicznego repozytorium ECR**  
1. PrzejdÅº do **AWS Management Console** â†’ **Amazon ECR**.  
2. Kliknij **Public registries** w menu bocznym.  
3. Kliknij **Create repository**.  
4. W sekcji **Visibility settings** wybierz **Public**.  
5. Wpisz **Repository name**: `my-public-repo`.  
6. (Opcjonalnie) WÅ‚Ä…cz **Tag immutability**, aby zapobiec nadpisywaniu obrazÃ³w.  
7. Kliknij **Create repository**.  

ğŸ“Œ **Repozytorium `my-public-repo` zostaÅ‚o utworzone i jest publicznie dostÄ™pne!** ğŸ‰  

---

**2. Sprawdzenie publicznego dostÄ™pu do repozytorium**  
1. PrzejdÅº do zakÅ‚adki **Settings** repozytorium.  
2. Upewnij siÄ™, Å¼e **Visibility settings** to **Public**.  
3. Skopiuj **URI repozytorium**, np.:  
   ```
   public.ecr.aws/xyz123/my-public-repo
   ```
4. W przeglÄ…darce otwÃ³rz stronÄ™ **Amazon ECR Public Gallery**:  
   ```
   https://gallery.ecr.aws/
   ```
5. Wyszukaj swoje repozytorium i sprawdÅº, czy jest dostÄ™pne.  

ğŸ“Œ **Twoje repozytorium jest teraz publiczne i dostÄ™pne dla innych uÅ¼ytkownikÃ³w!**  
</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

**1. Tworzenie publicznego repozytorium**  
```sh
aws ecr-public create-repository --repository-name my-public-repo
```
PrzykÅ‚adowa odpowiedÅº:  
```json
{
    "repository": {
        "repositoryArn": "arn:aws:ecr-public::123456789012:repository/my-public-repo",
        "repositoryName": "my-public-repo",
        "repositoryUri": "public.ecr.aws/xyz123/my-public-repo"
    }
}
```
ğŸ“Œ **Zapisz `repositoryUri`, poniewaÅ¼ bÄ™dzie potrzebne do wysyÅ‚ania i pobierania obrazÃ³w Docker.**  

---

**2. Sprawdzenie statusu repozytorium**  
```sh
aws ecr-public describe-repositories
```
ğŸ“Œ SprawdÅº, czy repozytorium `my-public-repo` znajduje siÄ™ na liÅ›cie.  

---

**3. Pobranie informacji o uprawnieniach repozytorium**  
```sh
aws ecr-public get-repository-policy --repository-name my-public-repo
```
ğŸ“Œ DomyÅ›lnie repozytorium publiczne powinno umoÅ¼liwiaÄ‡ pobieranie obrazÃ³w wszystkim uÅ¼ytkownikom.  

</details>

---

## **3. WysyÅ‚anie obrazu Docker do ECR**  
- Zaloguj siÄ™ do ECR przy uÅ¼yciu **AWS CLI**.  
- UtwÃ³rz lokalny obraz Docker (np. **Nginx**).  
- Wypchnij obraz do repozytorium ECR.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

**1. Pobranie i przygotowanie obrazu Docker**
1. OtwÃ³rz terminal na swojej maszynie.  
2. Pobierz obraz **Nginx**:  
   ```sh
   docker pull nginx:latest
   ```
3. Zweryfikuj, Å¼e obraz zostaÅ‚ pobrany:  
   ```sh
   docker images
   ```
   ğŸ“Œ Obraz **nginx** powinien byÄ‡ widoczny na liÅ›cie.

---

**2. Logowanie do Amazon ECR Public**
1. PrzejdÅº do **AWS Management Console** â†’ **Amazon ECR**.  
2. Wybierz **Public registries** i znajdÅº swoje repozytorium **my-public-repo**.  
3. Skopiuj **Public repository URI**, np.:  
   ```
   public.ecr.aws/xyz123/my-public-repo
   ```

4. W terminalu zaloguj siÄ™ do Amazon ECR Public:  
   ```sh
   aws ecr-public get-login-password --region us-east-1 | docker login --username AWS --password-stdin public.ecr.aws
   ```

ğŸ“Œ **JesteÅ› teraz zalogowany do ECR Public i moÅ¼esz wysyÅ‚aÄ‡ obrazy.**

---

**3. Przetagowanie obrazu Docker**
1. Nadaj obrazowi nowÄ… nazwÄ™ zgodnÄ… z repozytorium ECR:  
   ```sh
   docker tag nginx:latest public.ecr.aws/xyz123/my-public-repo/nginx:latest
   ```

---

**4. WysÅ‚anie obrazu do ECR Public**
1. PrzeÅ›lij obraz do repozytorium:  
   ```sh
   docker push public.ecr.aws/xyz123/my-public-repo/nginx:latest
   ```

2. SprawdÅº, czy obraz pojawiÅ‚ siÄ™ w **AWS Console** â†’ **ECR Public** â†’ **my-public-repo** â†’ **Images**.  

ğŸ“Œ **Obraz zostaÅ‚ pomyÅ›lnie przesÅ‚any do publicznego ECR i jest dostÄ™pny dla kaÅ¼dego uÅ¼ytkownika!** ğŸ‰  

</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

**1. Pobranie obrazu Docker**
```sh
docker pull nginx:latest
```

**2. Logowanie do Amazon ECR Public**
```sh
aws ecr-public get-login-password --region us-east-1 | docker login --username AWS --password-stdin public.ecr.aws
```

**3. Przetagowanie obrazu Docker**
```sh
docker tag nginx:latest public.ecr.aws/xyz123/my-public-repo/nginx:latest
```

**4. WysÅ‚anie obrazu do Amazon ECR Public**
```sh
docker push public.ecr.aws/xyz123/my-public-repo/nginx:latest
```

**5. Sprawdzenie listy obrazÃ³w w repozytorium**
```sh
aws ecr-public describe-images --repository-name my-public-repo
```

ğŸ“Œ **Obraz jest teraz publicznie dostÄ™pny i moÅ¼e byÄ‡ pobrany przez kaÅ¼dego uÅ¼ytkownika!** ğŸ‰  
</details>

---

## **4. Pobieranie obrazu z ECR i uruchamianie kontenera**  
- Pobierz obraz Docker z ECR.  
- Uruchom kontener lokalnie przy uÅ¼yciu pobranego obrazu.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

**1. Znalezienie publicznego repozytorium ECR**  
1. PrzejdÅº do **AWS Management Console** â†’ **Amazon ECR**.  
2. Wybierz **Public registries** w menu bocznym.  
3. ZnajdÅº repozytorium `my-public-repo` i skopiuj **Repository URI**, np.:  
   ```
   public.ecr.aws/xyz123/my-public-repo
   ```
4. Kliknij w repozytorium i przejdÅº do zakÅ‚adki **Images**.  
5. Skopiuj peÅ‚ny URI obrazu (np. `public.ecr.aws/xyz123/my-public-repo/nginx:latest`).  

---

**2. Pobranie obrazu Docker**  
1. OtwÃ³rz terminal i wykonaj komendÄ™:  
   ```sh
   docker pull public.ecr.aws/xyz123/my-public-repo/nginx:latest
   ```
2. SprawdÅº, czy obraz zostaÅ‚ pobrany:  
   ```sh
   docker images
   ```

ğŸ“Œ **Obraz zostaÅ‚ pobrany z Amazon ECR Public!**  

---

**3. Uruchomienie kontenera z pobranego obrazu**  
1. W terminalu uruchom kontener na podstawie obrazu:  
   ```sh
   docker run -d -p 8080:80 public.ecr.aws/xyz123/my-public-repo/nginx:latest
   ```
2. SprawdÅº dziaÅ‚ajÄ…ce kontenery:  
   ```sh
   docker ps
   ```
3. OtwÃ³rz przeglÄ…darkÄ™ i wpisz `http://localhost:8080` â€“ powinieneÅ› zobaczyÄ‡ stronÄ™ domyÅ›lnÄ… **Nginx**.  

ğŸ“Œ **Obraz zostaÅ‚ pobrany i dziaÅ‚a jako kontener Docker!** ğŸ‰  
</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

**1. Pobranie obrazu Docker z Amazon ECR Public**  
```sh
docker pull public.ecr.aws/xyz123/my-public-repo/nginx:latest
```

**2. Sprawdzenie dostÄ™pnych obrazÃ³w Docker**  
```sh
docker images
```

**3. Uruchomienie kontenera z obrazu ECR Public**  
```sh
docker run -d -p 8080:80 public.ecr.aws/xyz123/my-public-repo/nginx:latest
```

**4. Sprawdzenie dziaÅ‚ajÄ…cych kontenerÃ³w**  
```sh
docker ps
```

ğŸ“Œ **Strona Nginx powinna byÄ‡ teraz dostÄ™pna na `http://localhost:8080`.**  
</details>

---

## **5. Konfiguracja polityki usuwania nieuÅ¼ywanych obrazÃ³w**  
- Skonfiguruj politykÄ™ **automatycznego usuwania** starych wersji obrazÃ³w.  
- Przetestuj, czy obrazy starsze niÅ¼ np. 7 dni sÄ… usuwane.  
 
<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

**1. Znalezienie publicznego repozytorium ECR**  
1. PrzejdÅº do **AWS Management Console** â†’ **Amazon ECR**.  
2. Kliknij **Public registries** w menu bocznym.  
3. ZnajdÅº repozytorium `my-public-repo` i kliknij w nie.  

---

**2. Konfiguracja polityki usuwania obrazÃ³w**  
1. PrzejdÅº do zakÅ‚adki **Lifecycle Policy**.  
2. Kliknij **Create lifecycle policy**.  
3. Kliknij **Create rule** i ustaw nastÄ™pujÄ…ce wartoÅ›ci:  
   - **Rule name**: `DeleteOldImages`  
   - **Description**: `Remove images older than 7 days`  
   - **Tag prefix list**: `nginx`  
   - **Maximum image count**: `5` (pozostawi tylko 5 najnowszych wersji)  
   - **Action**: `Expire`  
4. Kliknij **Save**.  
</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

**1. Tworzenie polityki usuwania nieuÅ¼ywanych obrazÃ³w**  
UtwÃ³rz plik JSON `lifecycle-policy.json` z nastÄ™pujÄ…cÄ… konfiguracjÄ…:  

```json
{
    "rules": [
        {
            "rulePriority": 1,
            "description": "Remove images older than 7 days",
            "selection": {
                "tagStatus": "tagged",
                "tagPrefixList": ["nginx"],
                "countType": "imageCountMoreThan",
                "countNumber": 5
            },
            "action": {
                "type": "expire"
            }
        }
    ]
}
```

**2. Zastosowanie polityki do repozytorium**  
```sh
aws ecr-public put-lifecycle-policy \
    --repository-name my-public-repo \
    --lifecycle-policy-text file://lifecycle-policy.json
```

**3. Sprawdzenie aktywnej polityki w repozytorium**  
```sh
aws ecr-public get-lifecycle-policy --repository-name my-public-repo
```

ğŸ“Œ **Teraz starsze obrazy bÄ™dÄ… automatycznie usuwane, gdy liczba wersji przekroczy 5!** ğŸ‰  
</details>

---

## **6. Uruchamianie kontenera w Amazon ECS przy uÅ¼yciu obrazu z ECR**  
- Skonfiguruj **klaster ECS** z typem **Fargate**.  
- UtwÃ³rz **zadanie ECS**, ktÃ³re korzysta z obrazu znajdujÄ…cego siÄ™ w ECR.  
- Uruchom zadanie i sprawdÅº jego status.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

**1. Tworzenie klastra ECS w trybie Fargate**  
1. PrzejdÅº do **AWS Management Console** â†’ **Amazon ECS**.  
2. Kliknij **Clusters** â†’ **Create Cluster**.  
3. Wybierz **Networking only (Fargate)** i kliknij **Next step**.  
4. Wpisz **Cluster name**: `my-ecs-cluster`.  
5. Kliknij **Create**.  

ğŸ“Œ **Klaster ECS zostaÅ‚ utworzony!** ğŸ‰  

---

**2. Tworzenie definicji zadania (Task Definition)**  
1. PrzejdÅº do **Task Definitions** â†’ **Create new task definition**.  
2. Wybierz **Fargate** jako typ uruchomienia i kliknij **Next step**.  
3. Wpisz **Task definition name**: `nginx-task`.  
4. **Task Role**: pozostaw domyÅ›lnÄ… (`None`).  
5. **Task size**:  
   - **CPU**: `0.5 vCPU`  
   - **Memory**: `1 GB`  
6. Kliknij **Add container** i skonfiguruj:  
   - **Container name**: `nginx-container`.  
   - **Image**: `public.ecr.aws/xyz123/my-public-repo/nginx:latest` (skopiuj z repozytorium ECR Public).  
   - **Port mappings**: `Container port: 80`, **Protocol: TCP**.  
7. Kliknij **Create**.  

ğŸ“Œ **Definicja zadania jest gotowa do uÅ¼ycia!**  

---

**3. Tworzenie usÅ‚ugi ECS (Service)**  
1. PrzejdÅº do **Clusters** â†’ **my-ecs-cluster** â†’ **Create Service**.  
2. Wybierz:  
   - **Launch type**: `Fargate`.  
   - **Task definition**: `nginx-task`.  
   - **Cluster**: `my-ecs-cluster`.  
   - **Service name**: `nginx-service`.  
   - **Number of tasks**: `1`.  
3. **Networking**:  
   - Wybierz domyÅ›lny **VPC** i subnety.  
   - **Security group**: OtwÃ³rz port `80` dla ruchu HTTP.  
4. Kliknij **Create Service**.  

ğŸ“Œ **ECS uruchomi teraz kontener Nginx na Fargate!** ğŸ‰  

---

**4. Sprawdzenie uruchomionego kontenera**  
1. PrzejdÅº do **Clusters** â†’ **my-ecs-cluster** â†’ **Tasks**.  
2. Kliknij zadanie `nginx-task`, aby zobaczyÄ‡ szczegÃ³Å‚y.  
3. Skopiuj **Public IP** i otwÃ³rz w przeglÄ…darce:  
   ```
   http://<PUBLIC_IP>
   ```
4. Powinna wyÅ›wietliÄ‡ siÄ™ domyÅ›lna strona **Nginx**.  

ğŸ“Œ **Kontener dziaÅ‚a na Amazon ECS!** ğŸ‰  
</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

**1. Tworzenie klastra ECS w trybie Fargate**  
```sh
aws ecs create-cluster --cluster-name my-ecs-cluster
```

---

**2. Tworzenie definicji zadania (Task Definition)**  
UtwÃ³rz plik `nginx-task-definition.json`:  
```json
{
  "family": "nginx-task",
  "networkMode": "awsvpc",
  "requiresCompatibilities": ["FARGATE"],
  "cpu": "512",
  "memory": "1024",
  "containerDefinitions": [
    {
      "name": "nginx-container",
      "image": "public.ecr.aws/xyz123/my-public-repo/nginx:latest",
      "essential": true,
      "portMappings": [
        {
          "containerPort": 80,
          "hostPort": 80,
          "protocol": "tcp"
        }
      ]
    }
  ]
}
```

Zarejestruj definicjÄ™ zadania:  
```sh
aws ecs register-task-definition --cli-input-json file://nginx-task-definition.json
```

---

**3. Tworzenie usÅ‚ugi ECS**  
ğŸ“Œ Pobierz **ID subnetÃ³w** i **security group**:  
```sh
aws ec2 describe-subnets --query 'Subnets[*].SubnetId'
aws ec2 describe-security-groups --query 'SecurityGroups[*].GroupId'
```

ğŸ“Œ UtwÃ³rz usÅ‚ugÄ™ ECS:  
```sh
aws ecs create-service \
    --cluster my-ecs-cluster \
    --service-name nginx-service \
    --task-definition nginx-task \
    --desired-count 1 \
    --launch-type FARGATE \
    --network-configuration "awsvpcConfiguration={subnets=[subnet-xxxxx],securityGroups=[sg-xxxxx],assignPublicIp=\"ENABLED\"}"
```

ğŸ“Œ **ECS uruchomi teraz kontener Nginx!** ğŸ‰  

---

**4. Sprawdzenie uruchomionego kontenera**  
ğŸ“Œ Pobierz listÄ™ uruchomionych zadaÅ„:  
```sh
aws ecs list-tasks --cluster my-ecs-cluster
```

ğŸ“Œ Pobierz szczegÃ³Å‚y zadania:  
```sh
aws ecs describe-tasks --cluster my-ecs-cluster --tasks <TASK_ID>
```

ğŸ“Œ Pobierz **Public IP** i sprawdÅº dostÄ™pnoÅ›Ä‡ strony Nginx:  
```sh
aws ec2 describe-network-interfaces --query "NetworkInterfaces[*].Association.PublicIp"
```
OtwÃ³rz w przeglÄ…darce:  
```
http://<PUBLIC_IP>
```

ğŸ“Œ **Kontener dziaÅ‚a w Amazon ECS!** ğŸ‰  
</details>

---

## **7. Konfiguracja automatycznego pobierania obrazÃ³w z ECR w ECS**  
- Skonfiguruj **ECS Task Definition**, aby zawsze pobieraÅ‚ najnowszÄ… wersjÄ™ obrazu z ECR.  
- Przetestuj wdroÅ¼enie nowej wersji aplikacji i sprawdÅº, czy ECS pobraÅ‚ nowy obraz. 

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

**1. Modyfikacja definicji zadania (Task Definition)**  
1. PrzejdÅº do **AWS Management Console** â†’ **Amazon ECS**.  
2. Kliknij **Task Definitions** â†’ ZnajdÅº `nginx-task` â†’ **Create new revision**.  
3. W sekcji **Container Definitions**, kliknij w `nginx-container`.  
4. W polu **Image**, wpisz:  
   ```
   public.ecr.aws/xyz123/my-public-repo/nginx:latest
   ```
5. Kliknij **Update** â†’ **Create**.  

ğŸ“Œ **Teraz ECS bÄ™dzie pobieraÅ‚ najnowszy obraz `nginx:latest` przy uruchamianiu nowej wersji!** ğŸ‰  

---

**2. Aktualizacja usÅ‚ugi ECS do nowej wersji zadania**  
1. PrzejdÅº do **Clusters** â†’ **my-ecs-cluster** â†’ **Services**.  
2. Kliknij w `nginx-service`.  
3. Kliknij **Update** â†’ Wybierz nowÄ… wersjÄ™ `nginx-task` (najnowsza).  
4. Kliknij **Update Service**.  
5. Poczekaj, aÅ¼ ECS uruchomi nowÄ… wersjÄ™ kontenera.  

ğŸ“Œ **ECS automatycznie pobierze nowÄ… wersjÄ™ obrazu z publicznego ECR.**  

---

**3. Sprawdzenie, czy nowa wersja dziaÅ‚a**  
1. PrzejdÅº do **Clusters** â†’ **my-ecs-cluster** â†’ **Tasks**.  
2. Kliknij w nowÄ… instancjÄ™ zadania.  
3. Skopiuj **Public IP** i otwÃ³rz w przeglÄ…darce:  
   ```
   http://<PUBLIC_IP>
   ```
4. Powinna wyÅ›wietliÄ‡ siÄ™ **nowa wersja Nginx**.  

ğŸ“Œ **Kontener ECS zawsze pobiera najnowszÄ… wersjÄ™ obrazu z ECR!** ğŸ‰  
</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

**1. Tworzenie nowej rewizji zadania ECS**  
ğŸ“Œ UtwÃ³rz nowÄ… wersjÄ™ definicji zadania, zapisujÄ…c do pliku `nginx-task-update.json`:  

```json
{
  "family": "nginx-task",
  "networkMode": "awsvpc",
  "requiresCompatibilities": ["FARGATE"],
  "cpu": "512",
  "memory": "1024",
  "containerDefinitions": [
    {
      "name": "nginx-container",
      "image": "public.ecr.aws/xyz123/my-public-repo/nginx:latest",
      "essential": true,
      "portMappings": [
        {
          "containerPort": 80,
          "hostPort": 80,
          "protocol": "tcp"
        }
      ]
    }
  ]
}
```

ğŸ“Œ Zarejestruj nowÄ… wersjÄ™ zadania:  
```sh
aws ecs register-task-definition --cli-input-json file://nginx-task-update.json
```

---

**2. Pobranie nowej rewizji zadania ECS**  
```sh
aws ecs list-task-definitions --family-prefix nginx-task --sort DESC
```
ğŸ“Œ ZwrÃ³ci ID nowej rewizji, np. `nginx-task:2`.  

---

**3. Aktualizacja usÅ‚ugi ECS, aby uÅ¼ywaÅ‚a nowej wersji obrazu**  
```sh
aws ecs update-service \
    --cluster my-ecs-cluster \
    --service nginx-service \
    --task-definition nginx-task:2
```

ğŸ“Œ **Teraz ECS uruchomi nowÄ… wersjÄ™ kontenera z najnowszym obrazem!**  

---

**4. Sprawdzenie nowej instancji kontenera ECS**  
ğŸ“Œ Pobierz listÄ™ uruchomionych zadaÅ„:  
```sh
aws ecs list-tasks --cluster my-ecs-cluster
```

ğŸ“Œ Pobierz szczegÃ³Å‚y nowej instancji:  
```sh
aws ecs describe-tasks --cluster my-ecs-cluster --tasks <TASK_ID>
```

ğŸ“Œ Pobierz **Public IP** kontenera i sprawdÅº w przeglÄ…darce:  
```sh
aws ec2 describe-network-interfaces --query "NetworkInterfaces[*].Association.PublicIp"
```
OtwÃ³rz w przeglÄ…darce:  
```
http://<PUBLIC_IP>
```

ğŸ“Œ **ECS teraz pobiera najnowszÄ… wersjÄ™ obrazu Nginx z ECR Public!** ğŸ‰  
</details>