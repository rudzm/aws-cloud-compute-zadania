## **Zadania praktyczne dla sekcji 1: AWS RDS i DynamoDB** 

## **1. Tworzenie instancji bazy danych RDS**
- UtwÃ³rz instancjÄ™ **Amazon RDS** dla PostgreSQL.  
- Skonfiguruj parametry bazy i ustawienia sieciowe (VPC, Security Groups).  
- PoÅ‚Ä…cz siÄ™ z bazÄ… danych z poziomu terminala lub klienta SQL.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

**1. Tworzenie instancji RDS PostgreSQL**  
1. PrzejdÅº do **AWS Management Console** â†’ **Amazon RDS**.  
2. Kliknij **Create database**.  

---

**2. WybÃ³r silnika bazy danych**  
1. Wybierz **Engine type**:  
   - `PostgreSQL`  
2. Wybierz **Database creation method**:  
   - `Standard create`  
3. W sekcji **Templates** wybierz:  
   - `Free tier` (jeÅ›li dostÄ™pne)  

---

**3. Konfiguracja instancji**  
1. **DB instance identifier**: `my-postgres-db`  
2. **Master username**: `admin`  
3. **Master password**: `SuperStrongPassword123!`  
4. **DB instance class**: `db.t3.micro` (dla Free Tier)  
5. **Allocated storage**: `20 GiB`  

---

**4. Konfiguracja sieci**  
1. **VPC**: Wybierz domyÅ›lnÄ… lub utwÃ³rz nowÄ….  
2. **Public access**: `Yes` (aby umoÅ¼liwiÄ‡ dostÄ™p spoza VPC).  
3. **VPC security groups**:  
   - JeÅ›li tworzysz nowÄ… Security Group, upewnij siÄ™, Å¼e ma reguÅ‚Ä™ **Inbound** umoÅ¼liwiajÄ…cÄ… poÅ‚Ä…czenia na porcie **5432** z Twojego IP.  

---

**5. Tworzenie i uruchomienie instancji**  
1. Kliknij **Create database** i poczekaj na zakoÅ„czenie procesu (moÅ¼e potrwaÄ‡ kilka minut).  
2. Po zakoÅ„czeniu przejdÅº do **Databases** i skopiuj **Endpoint** instancji (np. `my-postgres-db.abc123xyz.us-east-1.rds.amazonaws.com`).  

---

**6. ÅÄ…czenie siÄ™ z bazÄ… za pomocÄ… psql**  
Na lokalnym komputerze zainstaluj klienta **psql** (jeÅ›li jeszcze go nie masz). NastÄ™pnie poÅ‚Ä…cz siÄ™ z bazÄ… uÅ¼ywajÄ…c poniÅ¼szego polecenia:  

```sh
psql -h my-postgres-db.abc123xyz.us-east-1.rds.amazonaws.com -U admin -d postgres
```

</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

**1. Tworzenie instancji RDS PostgreSQL**  
```sh
aws rds create-db-instance \
    --db-instance-identifier my-postgres-db \
    --db-instance-class db.t3.micro \
    --engine postgres \
    --allocated-storage 20 \
    --master-username admin \
    --master-user-password SuperStrongPassword123! \
    --backup-retention-period 7 \
    --publicly-accessible \
    --vpc-security-group-ids sg-0123456789abcdef0
```
ğŸ“Œ **ZastÄ…p `sg-0123456789abcdef0` identyfikatorem swojej Security Group.**  

---

**2. Pobranie Endpointu bazy danych**  
Po kilku minutach (gdy instancja jest gotowa) wykonaj:  
```sh
aws rds describe-db-instances --db-instance-identifier my-postgres-db --query "DBInstances[0].Endpoint.Address" --output text
```
Wynik bÄ™dzie wyglÄ…daÅ‚ np. tak:  
```
my-postgres-db.abc123xyz.us-east-1.rds.amazonaws.com
```

---

**3. ÅÄ…czenie siÄ™ z bazÄ… za pomocÄ… psql**  
PoÅ‚Ä…cz siÄ™ do bazy PostgreSQL za pomocÄ… pobranego endpointu:  
```sh
psql -h my-postgres-db.abc123xyz.us-east-1.rds.amazonaws.com -U admin -d postgres
```
Podaj hasÅ‚o `SuperStrongPassword123!`. JeÅ›li wszystko dziaÅ‚a poprawnie, powinieneÅ› zobaczyÄ‡ prompt PostgreSQL:  
```
postgres=#
```
</details>

---

## **2. Tworzenie uÅ¼ytkownikÃ³w i nadawanie rÃ³l w RDS**  
- UtwÃ³rz nowego uÅ¼ytkownika w bazie RDS.  
- Nadaj mu uprawnienia do odczytu i zapisu w okreÅ›lonej tabeli.  
- Zweryfikuj, czy uÅ¼ytkownik moÅ¼e wykonywaÄ‡ operacje zgodnie z nadanymi uprawnieniami.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

**1. PoÅ‚Ä…czenie z instancjÄ… RDS PostgreSQL**  
1. PrzejdÅº do **AWS Management Console** â†’ **Amazon RDS**.  
2. W zakÅ‚adce **Databases** znajdÅº swojÄ… bazÄ™ danych PostgreSQL.  
3. Skopiuj **Endpoint** (np. `my-postgres-db.abc123xyz.us-east-1.rds.amazonaws.com`).  
4. PoÅ‚Ä…cz siÄ™ z bazÄ… uÅ¼ywajÄ…c klienta **psql**:  

   ```sh
   psql -h my-postgres-db.abc123xyz.us-east-1.rds.amazonaws.com -U admin -d postgres
   ```

---

**2. Tworzenie nowego uÅ¼ytkownika w PostgreSQL**  
W terminalu **psql** wykonaj nastÄ™pujÄ…ce polecenie, aby utworzyÄ‡ uÅ¼ytkownika:  

```sql
CREATE USER new_user WITH PASSWORD 'SecurePass123!';
```

ğŸ“Œ **`new_user`** â€“ Nazwa nowego uÅ¼ytkownika  
ğŸ“Œ **`SecurePass123!`** â€“ Silne hasÅ‚o dla uÅ¼ytkownika  

---

**3. Tworzenie nowej bazy danych (opcjonalnie)**  
JeÅ›li chcesz, aby uÅ¼ytkownik pracowaÅ‚ na osobnej bazie, utwÃ³rz jÄ…:  

```sql
CREATE DATABASE company_db OWNER new_user;
```

---

**4. Nadanie uprawnieÅ„ do tabeli**  
JeÅ›li uÅ¼ytkownik ma pracowaÄ‡ na konkretnej bazie, poÅ‚Ä…cz siÄ™ z niÄ…:  

```sh
\c company_db
```

Tworzenie tabeli:  
```sql
CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    department VARCHAR(100)
);
```

Przyznanie uÅ¼ytkownikowi **peÅ‚nych uprawnieÅ„ do tabeli**:  
```sql
GRANT SELECT, INSERT, UPDATE, DELETE ON employees TO new_user;
```

ğŸ“Œ Teraz `new_user` moÅ¼e **odczytywaÄ‡, dodawaÄ‡, edytowaÄ‡ i usuwaÄ‡ dane** w tabeli `employees`.  

---

**5. Testowanie dostÄ™pu nowego uÅ¼ytkownika**  
1. Wyloguj siÄ™ z `psql` (`\q`).  
2. PoÅ‚Ä…cz siÄ™ ponownie jako `new_user`:  

   ```sh
   psql -h my-postgres-db.abc123xyz.us-east-1.rds.amazonaws.com -U new_user -d company_db
   ```

3. Przetestuj odczyt i zapis:  

   ```sql
   INSERT INTO employees (name, department) VALUES ('John Doe', 'Engineering');
   SELECT * FROM employees;
   ```
</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

**1. PoÅ‚Ä…czenie z instancjÄ… RDS PostgreSQL**  
Pobierz **Endpoint** instancji RDS:  
```sh
aws rds describe-db-instances --db-instance-identifier my-postgres-db --query "DBInstances[0].Endpoint.Address" --output text
```
NastÄ™pnie poÅ‚Ä…cz siÄ™ z bazÄ…:  
```sh
psql -h my-postgres-db.abc123xyz.us-east-1.rds.amazonaws.com -U admin -d postgres
```

---

**2. Tworzenie nowego uÅ¼ytkownika PostgreSQL przez CLI**  
```sh
echo "CREATE USER new_user WITH PASSWORD 'SecurePass123!';" | psql -h my-postgres-db.abc123xyz.us-east-1.rds.amazonaws.com -U admin -d postgres
```

---

**3. Tworzenie bazy danych (opcjonalnie)**  
```sh
echo "CREATE DATABASE company_db OWNER new_user;" | psql -h my-postgres-db.abc123xyz.us-east-1.rds.amazonaws.com -U admin -d postgres
```

---

**4. Nadanie uprawnieÅ„ do tabeli**  
Tworzenie tabeli:  
```sh
echo "CREATE TABLE employees (id SERIAL PRIMARY KEY, name VARCHAR(100), department VARCHAR(100));" | psql -h my-postgres-db.abc123xyz.us-east-1.rds.amazonaws.com -U admin -d company_db
```

Przyznanie uprawnieÅ„:  
```sh
echo "GRANT SELECT, INSERT, UPDATE, DELETE ON employees TO new_user;" | psql -h my-postgres-db.abc123xyz.us-east-1.rds.amazonaws.com -U admin -d company_db
```

---

**5. Testowanie dostÄ™pu nowego uÅ¼ytkownika**  
Zaloguj siÄ™ jako `new_user`:  
```sh
psql -h my-postgres-db.abc123xyz.us-east-1.rds.amazonaws.com -U new_user -d company_db
```

Wstawienie danych i ich odczyt:  
```sql
INSERT INTO employees (name, department) VALUES ('Alice Johnson', 'HR');
SELECT * FROM employees;
```
</details>

---

## **3. Tworzenie automatycznych backupÃ³w i snapshotÃ³w w RDS**  
- Skonfiguruj automatyczne backupy instancji RDS.  
- UtwÃ³rz rÄ™czny snapshot bazy danych.  
- PrzywrÃ³Ä‡ bazÄ™ z backupu i sprawdÅº, czy dane sÄ… poprawne.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

**1. WÅ‚Ä…czenie automatycznych backupÃ³w dla instancji RDS PostgreSQL**  
1. PrzejdÅº do **AWS Management Console** â†’ **Amazon RDS**.  
2. Kliknij w swojÄ… instancjÄ™ PostgreSQL.  
3. PrzejdÅº do zakÅ‚adki **Maintenance & backups**.  
4. W sekcji **Automated backups** sprawdÅº, czy sÄ… wÅ‚Ä…czone.  
   - JeÅ›li nie, kliknij **Modify**.  
5. W sekcji **Backup retention period** wybierz okres przechowywania backupÃ³w (np. `7 days`).  
6. W sekcji **Backup window** ustaw przedziaÅ‚ czasowy dla automatycznych backupÃ³w.  
7. Kliknij **Continue** â†’ **Apply immediately**.  

ğŸ“Œ **Teraz AWS RDS bÄ™dzie automatycznie tworzyÄ‡ backupy Twojej bazy danych.**  

---

**2. Tworzenie rÄ™cznego snapshotu bazy danych**  
1. PrzejdÅº do **AWS RDS** â†’ **Databases**.  
2. Wybierz swojÄ… instancjÄ™ PostgreSQL.  
3. Kliknij **Actions** â†’ **Take snapshot**.  
4. Wpisz **Snapshot name**: `mydb-snapshot-2024-02-12`.  
5. Kliknij **Create snapshot**.  
6. Poczekaj kilka minut, aÅ¼ snapshot zostanie utworzony.  

ğŸ“Œ **Snapshot zostaÅ‚ utworzony i moÅ¼na go uÅ¼yÄ‡ do przywracania bazy danych.**  

---

**3. Przywracanie bazy danych z rÄ™cznego snapshotu**  
1. PrzejdÅº do **AWS RDS** â†’ **Snapshots**.  
2. Wybierz snapshot `mydb-snapshot-2024-02-12`.  
3. Kliknij **Actions** â†’ **Restore snapshot**.  
4. Wpisz **DB instance identifier**: `restored-mydb-instance`.  
5. Kliknij **Restore DB instance**.  
6. Po zakoÅ„czeniu procesu znajdÅº nowÄ… instancjÄ™ i skopiuj jej **Endpoint**.  

ğŸ“Œ **Teraz moÅ¼esz poÅ‚Ä…czyÄ‡ siÄ™ z przywrÃ³conÄ… bazÄ… za pomocÄ… `psql`.**  

---

**4. Testowanie poÅ‚Ä…czenia do przywrÃ³conej bazy PostgreSQL**  
PoÅ‚Ä…cz siÄ™ do przywrÃ³conej instancji:  
```sh
psql -h restored-mydb-instance.xxxxxx.rds.amazonaws.com -U admin -d postgres
```

ğŸ“Œ **Baza danych zostaÅ‚a przywrÃ³cona i jest gotowa do uÅ¼ytku!**  

</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

**1. Konfiguracja automatycznych backupÃ³w RDS PostgreSQL**  
```sh
aws rds modify-db-instance \
    --db-instance-identifier my-postgres-db \
    --backup-retention-period 7 \
    --apply-immediately
```
ğŸ“Œ **To polecenie ustawia okres przechowywania backupÃ³w na 7 dni.**  

---

**2. Tworzenie rÄ™cznego snapshotu instancji RDS**  
```sh
aws rds create-db-snapshot \
    --db-instance-identifier my-postgres-db \
    --db-snapshot-identifier mydb-snapshot-2024-02-12
```

Sprawdzenie statusu snapshotu:  
```sh
aws rds describe-db-snapshots --db-snapshot-identifier mydb-snapshot-2024-02-12
```

---

**3. Przywracanie bazy danych z rÄ™cznego snapshotu**  
```sh
aws rds restore-db-instance-from-db-snapshot \
    --db-instance-identifier restored-mydb-instance \
    --db-snapshot-identifier mydb-snapshot-2024-02-12
```

Sprawdzenie statusu przywracanej instancji:  
```sh
aws rds describe-db-instances --db-instance-identifier restored-mydb-instance
```

---

**4. Testowanie poÅ‚Ä…czenia do przywrÃ³conej bazy PostgreSQL**  
Po odzyskaniu bazy uzyskaj jej **Endpoint**:  
```sh
aws rds describe-db-instances --db-instance-identifier restored-mydb-instance \
    --query "DBInstances[0].Endpoint.Address" --output text
```
PoÅ‚Ä…cz siÄ™ z nowÄ… bazÄ… danych:  
```sh
psql -h restored-mydb-instance.xxxxxx.rds.amazonaws.com -U admin -d postgres
```

</details>

---

## **4. Tworzenie tabeli w DynamoDB i wstawianie danych**  
- UtwÃ³rz tabelÄ™ w **Amazon DynamoDB** z kluczem gÅ‚Ã³wnym.  
- Dodaj kilka rekordÃ³w do tabeli.  
- Pobierz dane przy uÅ¼yciu operacji `GetItem` i `Scan`.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

**1. Tworzenie tabeli w Amazon DynamoDB**  
1. PrzejdÅº do **AWS Management Console** â†’ **DynamoDB**.  
2. Kliknij **Create table**.  
3. WypeÅ‚nij podstawowe informacje:  
   - **Table name**: `Employees`  
   - **Partition key**: `EmployeeID` (Type: `Number`)  
   - (Opcjonalnie) **Sort key**: `Department` (Type: `String`)  
4. W sekcji **Settings** pozostaw domyÅ›lne wartoÅ›ci.  
5. Kliknij **Create table**.  
6. Poczekaj, aÅ¼ tabela przejdzie do stanu **Active**.  

ğŸ“Œ **Tabela `Employees` jest gotowa do uÅ¼ycia!**  

---

**2. Dodawanie danych do tabeli DynamoDB**  
1. PrzejdÅº do zakÅ‚adki **Items**.  
2. Kliknij **Create item**.  
3. WprowadÅº wartoÅ›ci:  
   ```json
   {
       "EmployeeID": 1001,
       "Name": "John Doe",
       "Department": "Engineering"
   }
   ```
4. Kliknij **Save**.  
5. PowtÃ³rz ten krok dla kilku rÃ³Å¼nych rekordÃ³w.  

ğŸ“Œ **Dane zostaÅ‚y dodane do tabeli!**  

---

**3. Pobieranie danych z tabeli**  
1. W zakÅ‚adce **Items** uÅ¼yj opcji **Scan**, aby zobaczyÄ‡ wszystkie rekordy.  
2. Wyszukaj pracownika z `EmployeeID = 1001` przy uÅ¼yciu opcji **Query**.  

</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

**1. Tworzenie tabeli w DynamoDB**  
```sh
aws dynamodb create-table \
    --table-name Employees \
    --attribute-definitions AttributeName=EmployeeID,AttributeType=N \
    --key-schema AttributeName=EmployeeID,KeyType=HASH \
    --billing-mode PAY_PER_REQUEST
```

Sprawdzenie statusu tabeli:  
```sh
aws dynamodb describe-table --table-name Employees --query "Table.TableStatus"
```
ğŸ“Œ Czekaj na status `ACTIVE`.  

---

**2. Dodawanie danych do tabeli DynamoDB**  
```sh
aws dynamodb put-item \
    --table-name Employees \
    --item '{
        "EmployeeID": {"N": "1001"},
        "Name": {"S": "John Doe"},
        "Department": {"S": "Engineering"}
    }'
```

Dodanie kolejnego rekordu:  
```sh
aws dynamodb put-item \
    --table-name Employees \
    --item '{
        "EmployeeID": {"N": "1002"},
        "Name": {"S": "Alice Johnson"},
        "Department": {"S": "HR"}
    }'
```

---

**3. Pobieranie danych z tabeli**  
ğŸ“Œ Pobranie wszystkich rekordÃ³w (`Scan`):  
```sh
aws dynamodb scan --table-name Employees
```

ğŸ“Œ Pobranie konkretnego pracownika (`Query`):  
```sh
aws dynamodb get-item --table-name Employees \
    --key '{"EmployeeID": {"N": "1001"}}'
```
</details>

---

## **5. Indeksowanie i optymalizacja zapytaÅ„ w DynamoDB**  
- UtwÃ³rz **Global Secondary Index (GSI)** dla tabeli.  
- Wykonaj zapytania wykorzystujÄ…ce indeks i porÃ³wnaj wyniki z zapytaniami podstawowymi.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

**1. Tworzenie tabeli DynamoDB (jeÅ›li jeszcze jej nie ma)**  
1. PrzejdÅº do **AWS Management Console** â†’ **DynamoDB**.  
2. Kliknij **Create table**.  
3. Wpisz nazwÄ™ tabeli: `Employees`.  
4. **Partition key**: `EmployeeID` (Type: `Number`).  
5. (Opcjonalnie) **Sort key**: `Department` (Type: `String`).  
6. Kliknij **Create table** i poczekaj na status **Active**.  

---

**2. Dodanie Global Secondary Index (GSI)**  
1. PrzejdÅº do **AWS DynamoDB** â†’ **Tables** â†’ **Employees**.  
2. Kliknij **Indexes** â†’ **Create index**.  
3. WprowadÅº wartoÅ›ci:  
   - **Partition key**: `Department` (Type: `String`).  
   - **Sort key (opcjonalnie)**: `EmployeeID` (Type: `Number`).  
   - **Projection type**: `All` (aby indeks zawieraÅ‚ wszystkie atrybuty).  
4. Kliknij **Create index**.  
5. Poczekaj, aÅ¼ indeks przejdzie do stanu **Active**.  

ğŸ“Œ **Indeks zostaÅ‚ dodany i moÅ¼na go uÅ¼ywaÄ‡ do szybszego wyszukiwania pracownikÃ³w wedÅ‚ug dziaÅ‚u!**  

---

**3. Testowanie zapytaÅ„ z wykorzystaniem GSI**  
1. PrzejdÅº do zakÅ‚adki **Items**.  
2. Kliknij **Query**.  
3. Wybierz **Index name**: `Department-index`.  
4. WprowadÅº `Department = "Engineering"`.  
5. Kliknij **Run query**.  
</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

**1. Tworzenie tabeli DynamoDB (jeÅ›li jeszcze jej nie ma)**  
```sh
aws dynamodb create-table \
    --table-name Employees \
    --attribute-definitions AttributeName=EmployeeID,AttributeType=N AttributeName=Department,AttributeType=S \
    --key-schema AttributeName=EmployeeID,KeyType=HASH \
    --billing-mode PAY_PER_REQUEST
```

---

**2. Dodanie Global Secondary Index (GSI) do istniejÄ…cej tabeli**  
```sh
aws dynamodb update-table \
    --table-name Employees \
    --attribute-definitions AttributeName=Department,AttributeType=S \
    --global-secondary-index-updates '[{
        "Create": {
            "IndexName": "Department-index",
            "KeySchema": [
                {"AttributeName": "Department", "KeyType": "HASH"},
                {"AttributeName": "EmployeeID", "KeyType": "RANGE"}
            ],
            "Projection": {"ProjectionType": "ALL"}
        }
    }]'
```

Sprawdzenie statusu indeksu:  
```sh
aws dynamodb describe-table --table-name Employees --query "Table.GlobalSecondaryIndexes"
```

ğŸ“Œ **Poczekaj na status `ACTIVE` przed wykonaniem zapytaÅ„.**  

---

**3. Testowanie zapytaÅ„ z GSI**  
ğŸ“Œ Pobranie wszystkich pracownikÃ³w z dziaÅ‚u "Engineering"  
```sh
aws dynamodb query \
    --table-name Employees \
    --index-name Department-index \
    --key-condition-expression "Department = :dept" \
    --expression-attribute-values '{":dept": {"S": "Engineering"}}'
```
</details>

---

## **6. Tworzenie reguÅ‚ TTL dla automatycznego usuwania starych danych**  
- Skonfiguruj pole **TTL** w tabeli DynamoDB dla automatycznego usuwania rekordÃ³w po okreÅ›lonym czasie.  
- Zweryfikuj, czy stare rekordy sÄ… usuwane zgodnie z konfiguracjÄ….  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

**1. Tworzenie tabeli DynamoDB (jeÅ›li jeszcze jej nie ma)**  
1. PrzejdÅº do **AWS Management Console** â†’ **DynamoDB**.  
2. Kliknij **Create table**.  
3. Wpisz **Table name**: `Sessions`.  
4. **Partition key**: `SessionID` (Type: `String`).  
5. Kliknij **Create table** i poczekaj na status **Active**.  

---

**2. WÅ‚Ä…czenie TTL w tabeli DynamoDB**  
1. PrzejdÅº do zakÅ‚adki **Tables** â†’ Wybierz `Sessions`.  
2. PrzejdÅº do zakÅ‚adki **Additional settings**.  
3. Kliknij **Edit** w sekcji **Time to Live (TTL) attribute**.  
4. Wpisz nazwÄ™ pola TTL: `ExpirationTime`.  
5. Kliknij **Enable TTL** i poczekaj, aÅ¼ status zmieni siÄ™ na **Enabled**.  

ğŸ“Œ **TTL jest teraz wÅ‚Ä…czone i DynamoDB automatycznie usunie rekordy, gdy ich czas wygaÅ›nie.**  

---

**3. Dodawanie danych z polem TTL**  
1. PrzejdÅº do zakÅ‚adki **Items**.  
2. Kliknij **Create item**.  
3. Dodaj wartoÅ›ci:  
   ```json
   {
       "SessionID": "abc123",
       "User": "JohnDoe",
       "ExpirationTime": 1707772800
   }
   ```
   ğŸ“Œ **`ExpirationTime`** to czas w **sekundach UNIX (Epoch Time)**, po ktÃ³rym rekord zostanie automatycznie usuniÄ™ty.  
4. Kliknij **Save**.  

---

**4. Weryfikacja usuniÄ™cia rekordu przez TTL**  
1. Wykonaj **Scan** w tabeli i sprawdÅº, czy rekord nadal istnieje.  
2. Po upÅ‚ywie `ExpirationTime` wpis zostanie automatycznie usuniÄ™ty.  
</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

**1. Tworzenie tabeli DynamoDB (jeÅ›li jeszcze jej nie ma)**  
```sh
aws dynamodb create-table \
    --table-name Sessions \
    --attribute-definitions AttributeName=SessionID,AttributeType=S \
    --key-schema AttributeName=SessionID,KeyType=HASH \
    --billing-mode PAY_PER_REQUEST
```

---

**2. WÅ‚Ä…czenie TTL na tabeli**  
```sh
aws dynamodb update-time-to-live \
    --table-name Sessions \
    --time-to-live-specification Enabled=true,AttributeName=ExpirationTime
```

Sprawdzenie statusu TTL:  
```sh
aws dynamodb describe-time-to-live --table-name Sessions
```
ğŸ“Œ PowinieneÅ› zobaczyÄ‡:  
```json
{
    "TimeToLiveDescription": {
        "TimeToLiveStatus": "ENABLED",
        "AttributeName": "ExpirationTime"
    }
}
```

---

**3. Dodawanie rekordu z polem TTL**  
PoniÅ¼szy rekord zostanie automatycznie usuniÄ™ty po upÅ‚ywie 1 godziny:  
```sh
EXPIRATION_TIME=$(($(date +%s) + 3600)) 
aws dynamodb put-item \
    --table-name Sessions \
    --item '{
        "SessionID": {"S": "abc123"},
        "User": {"S": "JohnDoe"},
        "ExpirationTime": {"N": "'"$EXPIRATION_TIME"'"}
    }'
```
ğŸ“Œ WartoÅ›Ä‡ `ExpirationTime` to aktualny czas UNIX + 1 godzina.  

---

**4. Weryfikacja usuniÄ™cia rekordu**  
Po kilku minutach sprawdÅº, czy rekord nadal istnieje:  
```sh
aws dynamodb scan --table-name Sessions
```
</details>

---

## **7. Przetwarzanie plikÃ³w z S3 i zapisywanie wynikÃ³w w DynamoDB**  
- UtwÃ³rz bucket S3 i przesyÅ‚aj pliki JSON.  
- Skonfiguruj **AWS Lambda**, aby automatycznie przetwarzaÅ‚a pliki i zapisywaÅ‚a dane w **DynamoDB**.  
- Zweryfikuj poprawnoÅ›Ä‡ zapisanych danych w tabeli.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

**1. Tworzenie bucketu S3**  
1. PrzejdÅº do **AWS Management Console** â†’ **Amazon S3**.  
2. Kliknij **Create bucket**.  
3. Wpisz **Bucket name**: `my-json-bucket`.  
4. Wybierz region i kliknij **Create bucket**.  

---

**2. Tworzenie tabeli w DynamoDB**  
1. PrzejdÅº do **AWS DynamoDB**.  
2. Kliknij **Create table**.  
3. Wpisz **Table name**: `ProcessedData`.  
4. **Partition key**: `RecordID` (Type: `String`).  
5. Kliknij **Create table**.  

---

**3. Tworzenie funkcji AWS Lambda**  
1. PrzejdÅº do **AWS Lambda** â†’ **Create function**.  
2. Wybierz **Author from scratch**.  
3. **Function name**: `S3ToDynamoDBLambda`.  
4. **Runtime**: `Python 3.9`.  
5. **Execution role**:  
   - Wybierz **Create a new role with basic permissions**.  
6. Kliknij **Create function**.  

---

**4. Modyfikacja roli IAM dla Lambda**  
1. PrzejdÅº do **AWS IAM** â†’ **Roles**.  
2. ZnajdÅº utworzonÄ… rolÄ™ dla Lambda (`S3ToDynamoDBLambda-role`).  
3. Kliknij **Attach policies** i dodaj:  
   - `AmazonS3ReadOnlyAccess` (do odczytu plikÃ³w z S3).  
   - `AmazonDynamoDBFullAccess` (do zapisu danych w DynamoDB).  

---

**5. Edycja kodu AWS Lambda**  
1. WrÃ³Ä‡ do zakÅ‚adki **Code** w funkcji Lambda.  
2. Wklej nastÄ™pujÄ…cy kod:  

   ```python
   import json
   import boto3

   s3 = boto3.client('s3')
   dynamodb = boto3.resource('dynamodb')
   table = dynamodb.Table('ProcessedData')

   def lambda_handler(event, context):
       for record in event['Records']:
           bucket_name = record['s3']['bucket']['name']
           file_key = record['s3']['object']['key']

           response = s3.get_object(Bucket=bucket_name, Key=file_key)
           file_content = response['Body'].read().decode('utf-8')
           data = json.loads(file_content)

           for item in data:
               table.put_item(Item=item)

       return {"statusCode": 200, "body": "Data processed successfully"}
   ```

3. Kliknij **Deploy**.  

---

**6. Konfiguracja wyzwalacza S3 dla Lambda**  
1. PrzejdÅº do zakÅ‚adki **Configuration** â†’ **Triggers**.  
2. Kliknij **Add trigger**.  
3. Wybierz **S3** jako ÅºrÃ³dÅ‚o wyzwalania.  
4. Wybierz bucket `my-json-bucket`.  
5. **Event type**: `PUT` (aby Lambda uruchamiaÅ‚a siÄ™ po przesÅ‚aniu pliku).  
6. Kliknij **Add**.  

---

**7. Testowanie**  
1. PrzeÅ›lij plik JSON do bucketu S3:  

   ```json
   [
       {"RecordID": "1", "Name": "Alice", "Age": 30},
       {"RecordID": "2", "Name": "Bob", "Age": 25}
   ]
   ```

2. Po kilku sekundach sprawdÅº tabelÄ™ **DynamoDB** â†’ **Items**.  
</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

**1. Tworzenie bucketu S3**  
```sh
aws s3api create-bucket --bucket my-json-bucket --region us-east-1
```

---

**2. Tworzenie tabeli w DynamoDB**  
```sh
aws dynamodb create-table \
    --table-name ProcessedData \
    --attribute-definitions AttributeName=RecordID,AttributeType=S \
    --key-schema AttributeName=RecordID,KeyType=HASH \
    --billing-mode PAY_PER_REQUEST
```

Sprawdzenie statusu tabeli:  
```sh
aws dynamodb describe-table --table-name ProcessedData
```

---

**3. Tworzenie roli IAM dla Lambda**  
```sh
aws iam create-role --role-name LambdaS3DynamoDBRole \
    --assume-role-policy-document '{
        "Version": "2012-10-17",
        "Statement": [{
            "Effect": "Allow",
            "Principal": {"Service": "lambda.amazonaws.com"},
            "Action": "sts:AssumeRole"
        }]
    }'
```

Dodanie uprawnieÅ„:  
```sh
aws iam attach-role-policy --role-name LambdaS3DynamoDBRole --policy-arn arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess
aws iam attach-role-policy --role-name LambdaS3DynamoDBRole --policy-arn arn:aws:iam::aws:policy/AmazonDynamoDBFullAccess
```

Pobranie ARN roli:  
```sh
aws iam get-role --role-name LambdaS3DynamoDBRole --query 'Role.Arn' --output text
```

---

**4. Tworzenie funkcji Lambda**  
Tworzymy plik **lambda_function.py**:  
```sh
echo 'import json
import boto3

s3 = boto3.client("s3")
dynamodb = boto3.resource("dynamodb")
table = dynamodb.Table("ProcessedData")

def lambda_handler(event, context):
    for record in event["Records"]:
        bucket_name = record["s3"]["bucket"]["name"]
        file_key = record["s3"]["object"]["key"]

        response = s3.get_object(Bucket=bucket_name, Key=file_key)
        file_content = response["Body"].read().decode("utf-8")
        data = json.loads(file_content)

        for item in data:
            table.put_item(Item=item)

    return {"statusCode": 200, "body": "Data processed successfully"}' > lambda_function.py
```

Spakowanie pliku ZIP:  
```sh
zip function.zip lambda_function.py
```

Tworzenie funkcji Lambda:  
```sh
aws lambda create-function --function-name S3ToDynamoDBLambda \
    --runtime python3.9 \
    --role arn:aws:iam::<AWS_ACCOUNT_ID>:role/LambdaS3DynamoDBRole \
    --handler lambda_function.lambda_handler \
    --zip-file fileb://function.zip
```

---

**5. Konfiguracja wyzwalacza S3**  
```sh
aws lambda add-permission \
    --function-name S3ToDynamoDBLambda \
    --statement-id S3TriggerPermission \
    --action "lambda:InvokeFunction" \
    --principal s3.amazonaws.com \
    --source-arn arn:aws:s3:::my-json-bucket \
    --source-account <AWS_ACCOUNT_ID>
```

```sh
aws s3api put-bucket-notification-configuration \
    --bucket my-json-bucket \
    --notification-configuration '{
        "LambdaFunctionConfigurations": [{
            "LambdaFunctionArn": "arn:aws:lambda:us-east-1:<AWS_ACCOUNT_ID>:function:S3ToDynamoDBLambda",
            "Events": ["s3:ObjectCreated:Put"]
        }]
    }'
```

---

**6. Testowanie**  
PrzeÅ›lij plik JSON do S3:  
```sh
echo '[{"RecordID": "1", "Name": "Alice", "Age": 30}, {"RecordID": "2", "Name": "Bob", "Age": 25}]' > data.json
aws s3 cp data.json s3://my-json-bucket/
```

Sprawdzenie zawartoÅ›ci tabeli:  
```sh
aws dynamodb scan --table-name ProcessedData
```
</details>