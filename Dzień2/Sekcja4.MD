## **Zadania praktyczne dla sekcji 4: EC2 ZarzÄ…dzanie** 

## **1. Planowanie automatycznego uruchamiania i zatrzymywania instancji**  
- Skonfiguruj **AWS EventBridge** do automatycznego wÅ‚Ä…czania i wyÅ‚Ä…czania instancji o okreÅ›lonych godzinach.

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

### **1. Tworzenie reguÅ‚y EventBridge do automatycznego uruchamiania instancji**  
1. PrzejdÅº do **AWS Management Console** â†’ **EventBridge**.  
2. Kliknij **Rules** â†’ **Create rule**.  
3. Wpisz **Rule name**: `StartEC2Instances`.  
4. W sekcji **Event source** wybierz **Schedule**.  
5. Wybierz **Cron expression** i ustaw harmonogram:  
   - PrzykÅ‚ad: `0 7 * * ? *` â†’ codziennie o **07:00 UTC**.  
6. W sekcji **Target** kliknij **EC2**.  
7. Wybierz **Action** â†’ **StartInstances**.  
8. Wybierz instancjÄ™ EC2 do uruchomienia.  
9. Kliknij **Create rule**.  

ğŸ“Œ **Instancja EC2 bÄ™dzie automatycznie uruchamiana o 07:00 UTC!** ğŸ‰  

---

### **2. Tworzenie reguÅ‚y EventBridge do automatycznego zatrzymywania instancji**  
1. WrÃ³Ä‡ do **AWS EventBridge** â†’ **Rules** â†’ **Create rule**.  
2. Wpisz **Rule name**: `StopEC2Instances`.  
3. W sekcji **Event source** wybierz **Schedule**.  
4. Wybierz **Cron expression** i ustaw harmonogram:  
   - PrzykÅ‚ad: `0 19 * * ? *` â†’ codziennie o **19:00 UTC**.  
5. W sekcji **Target** kliknij **EC2**.  
6. Wybierz **Action** â†’ **StopInstances**.  
7. Wybierz instancjÄ™ EC2 do zatrzymania.  
8. Kliknij **Create rule**.  

ğŸ“Œ **Instancja EC2 bÄ™dzie automatycznie zatrzymywana o 19:00 UTC!** ğŸ‰  
</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

### **1. Tworzenie reguÅ‚y EventBridge do uruchamiania instancji**  
```sh
aws events put-rule \
    --name "StartEC2Instances" \
    --schedule-expression "cron(0 7 * * ? *)"
```
ğŸ“Œ **ReguÅ‚a uruchomi siÄ™ codziennie o 07:00 UTC.**  

Dodanie instancji EC2 jako celu reguÅ‚y:  
```sh
aws events put-targets \
    --rule "StartEC2Instances" \
    --targets "Id"="1","Arn"="arn:aws:ec2:us-east-1:123456789012:instance/i-0123456789abcdef0"
```

Przyznanie EventBridge uprawnieÅ„ do uruchamiania instancji:  
```sh
aws iam put-role-policy \
    --role-name "AWSServiceRoleForEC2ScheduledEvents" \
    --policy-name "StartEC2Policy" \
    --policy-document '{
        "Version": "2012-10-17",
        "Statement": [
            {
                "Effect": "Allow",
                "Action": "ec2:StartInstances",
                "Resource": "arn:aws:ec2:us-east-1:123456789012:instance/i-0123456789abcdef0"
            }
        ]
    }'
```

---

### **2. Tworzenie reguÅ‚y EventBridge do zatrzymywania instancji**  
```sh
aws events put-rule \
    --name "StopEC2Instances" \
    --schedule-expression "cron(0 19 * * ? *)"
```
ğŸ“Œ **ReguÅ‚a zatrzyma instancjÄ™ codziennie o 19:00 UTC.**  

Dodanie instancji EC2 jako celu reguÅ‚y:  
```sh
aws events put-targets \
    --rule "StopEC2Instances" \
    --targets "Id"="1","Arn"="arn:aws:ec2:us-east-1:123456789012:instance/i-0123456789abcdef0"
```

Przyznanie EventBridge uprawnieÅ„ do zatrzymywania instancji:  
```sh
aws iam put-role-policy \
    --role-name "AWSServiceRoleForEC2ScheduledEvents" \
    --policy-name "StopEC2Policy" \
    --policy-document '{
        "Version": "2012-10-17",
        "Statement": [
            {
                "Effect": "Allow",
                "Action": "ec2:StopInstances",
                "Resource": "arn:aws:ec2:us-east-1:123456789012:instance/i-0123456789abcdef0"
            }
        ]
    }'
```
</details>

---

## **2. Tworzenie wÅ‚asnego obrazu AMI z instancji EC2**  
- Uruchom instancjÄ™ EC2, zainstaluj dodatkowe oprogramowanie i utwÃ³rz **obraz AMI**.  
- Uruchom nowÄ… instancjÄ™ z utworzonego obrazu.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

### **1. Przygotowanie instancji EC2 przed utworzeniem AMI**  
1. PrzejdÅº do **AWS Management Console** â†’ **EC2**.  
2. Wybierz instancjÄ™, ktÃ³rÄ… chcesz sklonowaÄ‡ do obrazu AMI.  
3. (Opcjonalnie) JeÅ›li chcesz uwzglÄ™dniÄ‡ najnowsze zmiany, uruchom w terminalu:  
   ```sh
   sudo yum update -y  # Dla Amazon Linux / RHEL
   sudo apt update -y  # Dla Ubuntu / Debian
   ```
4. (Opcjonalnie) Uruchom ponownie instancjÄ™, aby zastosowaÄ‡ zmiany:  
   ```sh
   sudo reboot
   ```

---

### **2. Tworzenie obrazu AMI**  
1. PrzejdÅº do **AWS EC2** â†’ **Instances**.  
2. Wybierz instancjÄ™, ktÃ³rÄ… chcesz sklonowaÄ‡.  
3. Kliknij **Actions** â†’ **Image and templates** â†’ **Create Image**.  
4. Wpisz **Image name**, np. `MyCustomAMI`.  
5. (Opcjonalnie) Dodaj opis obrazu.  
6. Wybierz **No reboot**, jeÅ›li nie chcesz restartowaÄ‡ instancji.  
7. Kliknij **Create Image**.  

ğŸ“Œ **AWS rozpocznie tworzenie obrazu AMI. Proces ten moÅ¼e potrwaÄ‡ kilka minut.**  

---

### **3. Sprawdzenie gotowego obrazu AMI**  
1. PrzejdÅº do **AWS EC2** â†’ **Images** â†’ **AMIs**.  
2. ZnajdÅº utworzony obraz `MyCustomAMI`.  
3. Po zakoÅ„czeniu procesu status zmieni siÄ™ na **Available**.  

ğŸ“Œ **Teraz moÅ¼esz uÅ¼yÄ‡ AMI do tworzenia nowych instancji EC2!** ğŸ‰  

</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

### **1. Pobranie ID instancji EC2**  
```sh
aws ec2 describe-instances --query "Reservations[*].Instances[*].InstanceId" --output text
```
ZaÅ‚Ã³Å¼my, Å¼e ID instancji to `i-0123456789abcdef0`.

---

### **2. Tworzenie obrazu AMI z instancji EC2**  
```sh
aws ec2 create-image \
    --instance-id i-0123456789abcdef0 \
    --name "MyCustomAMI" \
    --description "Custom AMI created from instance i-0123456789abcdef0" \
    --no-reboot
```
ğŸ“Œ **Dodaj `--no-reboot`, jeÅ›li nie chcesz restartowaÄ‡ instancji podczas tworzenia obrazu.**  

---

### **3. Sprawdzenie statusu obrazu AMI**  
```sh
aws ec2 describe-images --owners self --query "Images[*].[ImageId,State,Name]" --output table
```
ğŸ“Œ **Kiedy `State` zmieni siÄ™ na `available`, AMI jest gotowe do uÅ¼ycia!** ğŸ‰  

---

### **4. Tworzenie nowej instancji EC2 z obrazu AMI**  
Po utworzeniu AMI moÅ¼esz z niego uruchomiÄ‡ nowÄ… instancjÄ™:  
```sh
aws ec2 run-instances \
    --image-id ami-0123456789abcdef0 \
    --count 1 \
    --instance-type t2.micro \
    --key-name my-key \
    --security-groups my-security-group
```
ğŸ“Œ **PodmieÅ„ `ami-0123456789abcdef0` na ID swojego AMI.**  

</details>

---

## **3. UdostÄ™pnianie AMI innym kontom AWS**  
- Skonfiguruj uprawnienia AMI tak, aby byÅ‚o dostÄ™pne dla wybranych kont AWS.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

### **1. Znalezienie utworzonego obrazu AMI**  
1. PrzejdÅº do **AWS Management Console** â†’ **EC2**.  
2. W lewym menu kliknij **AMIs** (Images).  
3. ZnajdÅº obraz AMI, ktÃ³ry chcesz udostÄ™pniÄ‡.  
4. Zaznacz obraz i kliknij **Actions** â†’ **Modify Image Permissions**.  

---

### **2. UdostÄ™pnienie AMI innemu kontu AWS**  
1. W sekcji **Image Permissions** wybierz **Private**.  
2. W polu **Account ID** wpisz identyfikator konta AWS, ktÃ³remu chcesz udostÄ™pniÄ‡ obraz.  
3. Kliknij **Add Permission**.  
4. Kliknij **Save Changes**.  

ğŸ“Œ **Teraz AMI jest dostÄ™pne dla innego konta AWS!** ğŸ‰  

---

### **3. UdostÄ™pnienie powiÄ…zanych snapshotÃ³w (jeÅ›li AMI korzysta z EBS)**  
JeÅ›li obraz AMI uÅ¼ywa wolumenÃ³w **EBS**, musisz rÃ³wnieÅ¼ udostÄ™pniÄ‡ powiÄ…zany snapshot:  
1. PrzejdÅº do **AWS EC2** â†’ **Snapshots**.  
2. ZnajdÅº snapshot powiÄ…zany z AMI.  
3. Kliknij **Modify Permissions**.  
4. Dodaj identyfikator konta AWS i kliknij **Save Changes**.  

ğŸ“Œ **Teraz inne konto moÅ¼e korzystaÄ‡ zarÃ³wno z AMI, jak i z jego snapshotu!**  

</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

### **1. Pobranie listy dostÄ™pnych AMI**  
```sh
aws ec2 describe-images --owners self --query "Images[*].[ImageId,Name]" --output table
```
ZaÅ‚Ã³Å¼my, Å¼e AMI ma ID: `ami-0123456789abcdef0`.

---

### **2. UdostÄ™pnienie AMI innemu kontu AWS**  
```sh
aws ec2 modify-image-attribute \
    --image-id ami-0123456789abcdef0 \
    --launch-permission "Add=[{UserId='111122223333'}]"
```
ğŸ“Œ **ZmieÅ„ `111122223333` na ID konta, ktÃ³remu chcesz udostÄ™pniÄ‡ obraz.**  

---

### **3. UdostÄ™pnienie powiÄ…zanego snapshotu (jeÅ›li AMI uÅ¼ywa EBS)**  
ğŸ“Œ Najpierw znajdÅº snapshot powiÄ…zany z AMI:  
```sh
aws ec2 describe-images --image-ids ami-0123456789abcdef0 \
    --query "Images[*].BlockDeviceMappings[*].Ebs.SnapshotId"
```
ZaÅ‚Ã³Å¼my, Å¼e snapshot ma ID: `snap-0123456789abcdef0`.

ğŸ“Œ UdostÄ™pnij snapshot innemu kontu AWS:  
```sh
aws ec2 modify-snapshot-attribute \
    --snapshot-id snap-0123456789abcdef0 \
    --attribute createVolumePermission \
    --operation-type add \
    --user-ids 111122223333
```

ğŸ“Œ **Teraz inne konto moÅ¼e uÅ¼ywaÄ‡ AMI oraz jego snapshotu!** ğŸ‰  

---

### **4. Sprawdzenie, czy AMI zostaÅ‚o poprawnie udostÄ™pnione**  
```sh
aws ec2 describe-image-attribute \
    --image-id ami-0123456789abcdef0 \
    --attribute launchPermission
```
ğŸ“Œ **PowinieneÅ› zobaczyÄ‡ ID konta, ktÃ³remu udostÄ™pniono AMI.**  

</details>

---

## **4. Tworzenie i przywracanie snapshotÃ³w EBS**  
- UtwÃ³rz **snapshot** wolumenu EBS dla instancji EC2.  
- PrzywrÃ³Ä‡ snapshot do nowego wolumenu i podÅ‚Ä…cz go do innej instancji.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

### **1. Tworzenie snapshotu EBS**  
1. PrzejdÅº do **AWS Management Console** â†’ **EC2**.  
2. W lewym menu kliknij **Volumes**.  
3. Wybierz wolumen powiÄ…zany z TwojÄ… instancjÄ… EC2.  
4. Kliknij **Actions** â†’ **Create snapshot**.  
5. Wpisz **Description**, np. `Backup for EC2 Instance`.  
6. Kliknij **Create snapshot**.  

ğŸ“Œ **AWS rozpocznie tworzenie snapshotu, co moÅ¼e potrwaÄ‡ kilka minut.** ğŸ‰  

---

### **2. Sprawdzenie statusu snapshotu**  
1. PrzejdÅº do **AWS EC2** â†’ **Snapshots**.  
2. ZnajdÅº utworzony snapshot â€“ status powinien zmieniÄ‡ siÄ™ na **Completed**.  

---

### **3. Tworzenie nowego wolumenu EBS z istniejÄ…cego snapshotu**  
1. PrzejdÅº do **AWS EC2** â†’ **Snapshots**.  
2. Zaznacz snapshot i kliknij **Actions** â†’ **Create Volume**.  
3. Wybierz ten sam **region** co instancja EC2.  
4. Wybierz **typ wolumenu** (np. **gp3** dla SSD).  
5. Kliknij **Create Volume**.  

ğŸ“Œ **Wolumen EBS zostaÅ‚ utworzony na podstawie snapshotu!** ğŸ‰  

---

### **4. PodÅ‚Ä…czenie nowego wolumenu do instancji EC2**  
1. PrzejdÅº do **AWS EC2** â†’ **Volumes**.  
2. Zaznacz nowy wolumen i kliknij **Actions** â†’ **Attach Volume**.  
3. Wybierz instancjÄ™ EC2 i nazwÄ™ urzÄ…dzenia (np. `/dev/sdf`).  
4. Kliknij **Attach**.  

ğŸ“Œ **Teraz instancja EC2 ma dostÄ™p do nowego wolumenu!**  

</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

### **1. Tworzenie snapshotu EBS**  
ğŸ“Œ Pobierz **ID wolumenu**, ktÃ³ry chcesz zbackupowaÄ‡:  
```sh
aws ec2 describe-volumes --query "Volumes[*].[VolumeId,Size,State]" --output table
```
ZaÅ‚Ã³Å¼my, Å¼e wolumen ma ID: `vol-0123456789abcdef0`.  

ğŸ“Œ UtwÃ³rz snapshot:  
```sh
aws ec2 create-snapshot --volume-id vol-0123456789abcdef0 --description "Backup for EC2 Instance"
```

---

### **2. Sprawdzenie statusu snapshotu**  
```sh
aws ec2 describe-snapshots --query "Snapshots[*].[SnapshotId,State,StartTime]" --output table
```
ğŸ“Œ **Gdy `State` zmieni siÄ™ na `completed`, snapshot jest gotowy.**  

---

### **3. Tworzenie nowego wolumenu EBS ze snapshotu**  
ğŸ“Œ Pobierz **ID snapshotu**:  
```sh
aws ec2 describe-snapshots --query "Snapshots[*].[SnapshotId]" --output text
```
ZaÅ‚Ã³Å¼my, Å¼e snapshot ma ID: `snap-0123456789abcdef0`.  

ğŸ“Œ UtwÃ³rz nowy wolumen w tym samym regionie:  
```sh
aws ec2 create-volume --snapshot-id snap-0123456789abcdef0 --availability-zone us-east-1a --volume-type gp3
```
ğŸ“Œ **ZmieÅ„ `us-east-1a` na strefÄ™, w ktÃ³rej dziaÅ‚a Twoja instancja.**  

---

### **4. PodÅ‚Ä…czenie wolumenu do instancji EC2**  
ğŸ“Œ Pobierz **ID instancji EC2**, do ktÃ³rej chcesz podÅ‚Ä…czyÄ‡ nowy wolumen:  
```sh
aws ec2 describe-instances --query "Reservations[*].Instances[*].InstanceId" --output text
```
ZaÅ‚Ã³Å¼my, Å¼e instancja ma ID: `i-0123456789abcdef0`.  

ğŸ“Œ PodÅ‚Ä…cz nowy wolumen do instancji EC2:  
```sh
aws ec2 attach-volume --volume-id vol-0123456789abcdef0 --instance-id i-0123456789abcdef0 --device /dev/sdf
```

ğŸ“Œ **Instancja EC2 ma teraz dostÄ™p do nowego wolumenu EBS opartego na snapshotcie!** ğŸ‰  

</details>

---

## **5. Automatyzacja tworzenia snapshotÃ³w EBS**  
- Skonfiguruj **AWS Data Lifecycle Manager**, aby automatycznie tworzyÅ‚ snapshoty co 24 godziny.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

### **1. Tworzenie polityki automatycznego tworzenia snapshotÃ³w**  
1. PrzejdÅº do **AWS Management Console** â†’ **EC2**.  
2. W lewym menu wybierz **Lifecycle Manager** (w sekcji Elastic Block Store).  
3. Kliknij **Create lifecycle policy**.  
4. Wybierz **Policy type**: **EBS Snapshot Policy**.  
5. Kliknij **Next**.  

---

### **2. Konfiguracja reguÅ‚ tworzenia snapshotÃ³w**  
1. **Target resources**:  
   - Wybierz **Instance or Volume tags** i dodaj tag, np.  
     - **Key**: `Backup`  
     - **Value**: `Daily`  
   - Snapshoty bÄ™dÄ… tworzone dla wolumenÃ³w EBS z tym tagiem.  
2. **Schedule**:  
   - Wpisz **Policy Name**: `Daily-EBS-Snapshots`.  
   - Wybierz **Frequency**: `Every 24 hours`.  
   - Wybierz **Start Time**: np. `02:00 UTC`.  
   - OkreÅ›l liczbÄ™ snapshotÃ³w do zachowania, np. **7** (stare snapshoty bÄ™dÄ… automatycznie usuwane).  
3. **IAM Permissions**:  
   - System automatycznie przypisze wymagane uprawnienia.  
4. Kliknij **Create Policy**.  

ğŸ“Œ **Teraz AWS DLM bÄ™dzie automatycznie tworzyÅ‚ snapshoty EBS co 24 godziny!** ğŸ‰  

</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

### **1. Tworzenie polityki Data Lifecycle Manager (DLM)**  
```sh
aws dlm create-lifecycle-policy \
    --execution-role-arn arn:aws:iam::123456789012:role/AWSDataLifecycleManagerDefaultRole \
    --description "Daily snapshot policy for EBS volumes" \
    --state ENABLED \
    --policy-details '{
        "ResourceTypes": ["VOLUME"],
        "TargetTags": [{"Key": "Backup", "Value": "Daily"}],
        "Schedules": [{
            "Name": "Daily EBS Snapshots",
            "TagsToAdd": [{"Key": "SnapshotType", "Value": "Automated"}],
            "CreateRule": {"Interval": 24, "IntervalUnit": "HOURS", "Times": ["02:00"]},
            "RetainRule": {"Count": 7}
        }]
    }'
```
ğŸ“Œ **ZmieÅ„ `123456789012` na swÃ³j numer konta AWS.**  

---

### **2. Sprawdzenie statusu polityki**  
```sh
aws dlm get-lifecycle-policies
```
ğŸ“Œ **Wynik powinien pokazaÄ‡ politykÄ™ z `State: ENABLED`.**  

---

### **3. Dodanie tagu do wolumenu EBS, aby polityka dziaÅ‚aÅ‚a**  
ğŸ“Œ Pobierz **ID wolumenu**, ktÃ³ry chcesz objÄ…Ä‡ politykÄ…:  
```sh
aws ec2 describe-volumes --query "Volumes[*].[VolumeId]" --output text
```
ZaÅ‚Ã³Å¼my, Å¼e wolumen ma ID: `vol-0123456789abcdef0`.  

ğŸ“Œ Dodaj tag `Backup: Daily`:  
```sh
aws ec2 create-tags --resources vol-0123456789abcdef0 --tags Key=Backup,Value=Daily
```

ğŸ“Œ **Teraz AWS DLM automatycznie tworzy snapshoty dla wolumenÃ³w oznaczonych tagiem `Backup: Daily`.** ğŸ‰  

---

### **4. Sprawdzenie utworzonych snapshotÃ³w**  
```sh
aws ec2 describe-snapshots --owner-id 123456789012 --query "Snapshots[*].[SnapshotId,StartTime]" --output table
```
ğŸ“Œ **JeÅ›li snapshoty sÄ… tworzone zgodnie z harmonogramem, polityka dziaÅ‚a poprawnie!**  

</details>

---

## **6. Kopiowanie snapshotÃ³w do innego regionu AWS**  
- Skopiuj snapshot EBS do innego regionu w AWS Console i CLI.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

### **1. Znalezienie snapshotu do skopiowania**
1. PrzejdÅº do **AWS Management Console** â†’ **EC2**.  
2. W lewym menu kliknij **Snapshots**.  
3. ZnajdÅº snapshot, ktÃ³ry chcesz skopiowaÄ‡, i zaznacz go.  
4. Kliknij **Actions** â†’ **Copy Snapshot**.  

---

### **2. Konfiguracja kopiowania snapshotu**
1. W polu **Destination region** wybierz region docelowy (np. `us-west-2`).  
2. Wpisz **Description**, np. `Copy of snapshot for backup`.  
3. (Opcjonalnie) Wybierz **Encryption**:  
   - JeÅ›li snapshot byÅ‚ zaszyfrowany, zostanie skopiowany z tÄ… samÄ… konfiguracjÄ….  
   - JeÅ›li snapshot nie byÅ‚ zaszyfrowany, moÅ¼esz wybraÄ‡ nowy klucz KMS.  
4. Kliknij **Copy Snapshot**.  

ğŸ“Œ **AWS rozpocznie kopiowanie snapshotu. MoÅ¼e to potrwaÄ‡ kilka minut, w zaleÅ¼noÅ›ci od jego rozmiaru.** ğŸ‰  

---

### **3. Sprawdzenie skopiowanego snapshotu**
1. ZmieÅ„ region w prawym gÃ³rnym rogu na region docelowy (`us-west-2`).  
2. PrzejdÅº do **EC2** â†’ **Snapshots**.  
3. ZnajdÅº nowo skopiowany snapshot â€“ powinien mieÄ‡ status **completed**.  

ğŸ“Œ **Snapshot zostaÅ‚ pomyÅ›lnie skopiowany do nowego regionu!** ğŸ‰  

</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

### **1. Pobranie listy snapshotÃ³w w regionie ÅºrÃ³dÅ‚owym**  
```sh
aws ec2 describe-snapshots --owner-id 123456789012 --region us-east-1 \
    --query "Snapshots[*].[SnapshotId,StartTime]" --output table
```
ğŸ“Œ **ZmieÅ„ `123456789012` na swÃ³j numer konta AWS.**  

ZaÅ‚Ã³Å¼my, Å¼e snapshot do skopiowania ma ID: `snap-0123456789abcdef0`.

---

### **2. Kopiowanie snapshotu do nowego regionu**  
```sh
aws ec2 copy-snapshot \
    --source-region us-east-1 \
    --source-snapshot-id snap-0123456789abcdef0 \
    --destination-region us-west-2 \
    --description "Backup copy of snapshot snap-0123456789abcdef0"
```
ğŸ“Œ **ZmieÅ„ `us-east-1` i `us-west-2` na odpowiednie regiony.**  

---

### **3. Sprawdzenie statusu kopiowanego snapshotu**  
```sh
aws ec2 describe-snapshots --owner-id 123456789012 --region us-west-2 \
    --query "Snapshots[*].[SnapshotId,State,StartTime]" --output table
```
ğŸ“Œ **Gdy `State` zmieni siÄ™ na `completed`, snapshot jest gotowy do uÅ¼ycia w nowym regionie!** ğŸ‰  

---

### **4. Tworzenie wolumenu EBS z nowego snapshotu w regionie docelowym**  
```sh
aws ec2 create-volume \
    --snapshot-id snap-0123456789abcdef0 \
    --availability-zone us-west-2a \
    --volume-type gp3 \
    --region us-west-2
```
ğŸ“Œ **ZmieÅ„ `snap-0123456789abcdef0` na ID skopiowanego snapshotu i `us-west-2a` na odpowiedniÄ… strefÄ™ dostÄ™pnoÅ›ci.**  
</details>

---

## **7. Automatyczne patchowanie instancji EC2 za pomocÄ… AWS Systems Manager**  
- Skonfiguruj **AWS Systems Manager Patch Manager**, aby automatycznie aktualizowaÅ‚ system operacyjny instancji EC2.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

### **1. Konfiguracja AWS Systems Manager na instancji EC2**
1. PrzejdÅº do **AWS Management Console** â†’ **EC2**.  
2. Wybierz instancjÄ™ EC2 i przejdÅº do zakÅ‚adki **Permissions**.  
3. Upewnij siÄ™, Å¼e instancja ma rolÄ™ IAM z politykÄ… **AmazonSSMManagedInstanceCore**:  
   - JeÅ›li nie ma, utwÃ³rz nowÄ… rolÄ™ IAM dla EC2 i dodaj jÄ… do instancji.  

---

### **2. Tworzenie polityki aktualizacji w AWS Systems Manager**
1. PrzejdÅº do **AWS Systems Manager** â†’ **Patch Manager**.  
2. Kliknij **Configure patch policies**.  
3. Wybierz opcjÄ™ **Create patch policy**.  
4. W sekcji **Targets** wybierz instancje do aktualizacji (np. wszystkie z okreÅ›lonym tagiem).  
5. Wybierz **Operating System**:  
   - **Amazon Linux 2**, **Ubuntu**, **Windows**, itp.  
6. W sekcji **Patch classification** wybierz:  
   - `Security updates` (dla bezpieczeÅ„stwa)  
   - `Critical updates` (dla waÅ¼nych poprawek)  
7. Wybierz harmonogram (np. co tydzieÅ„, w soboty o 02:00 UTC).  
8. Kliknij **Create**.  

ğŸ“Œ **AWS Systems Manager bÄ™dzie teraz automatycznie aktualizowaÄ‡ instancje EC2!** ğŸ‰  

</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

### **1. Dodanie roli IAM do instancji EC2**
ğŸ“Œ SprawdÅº, czy instancja EC2 ma odpowiedniÄ… rolÄ™:  
```sh
aws ec2 describe-instances \
    --query "Reservations[*].Instances[*].[InstanceId,IamInstanceProfile.Arn]" --output table
```
ğŸ“Œ JeÅ›li brak roli IAM, utwÃ³rz jÄ…:  
```sh
aws iam create-role --role-name SSM-EC2-Role \
    --assume-role-policy-document '{
        "Version": "2012-10-17",
        "Statement": [
            {
                "Effect": "Allow",
                "Principal": { "Service": "ec2.amazonaws.com" },
                "Action": "sts:AssumeRole"
            }
        ]
    }'
```
ğŸ“Œ Przypisz politykÄ™ **AmazonSSMManagedInstanceCore** do roli:  
```sh
aws iam attach-role-policy \
    --role-name SSM-EC2-Role \
    --policy-arn arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore
```
ğŸ“Œ Przypisz rolÄ™ IAM do instancji EC2:  
```sh
aws ec2 associate-iam-instance-profile \
    --instance-id i-0123456789abcdef0 \
    --iam-instance-profile Name=SSM-EC2-Role
```

---

### **2. Tworzenie polityki aktualizacji w Systems Manager**
ğŸ“Œ UtwÃ³rz politykÄ™ Patch Manager dla Amazon Linux 2:  
```sh
aws ssm create-patch-baseline \
    --name "SecurityUpdates" \
    --operating-system AMAZON_LINUX_2 \
    --approval-rules "PatchRules=[{PatchFilterGroup={PatchFilters=[{Key='CLASSIFICATION',Values=['Security']}]},ApproveAfterDays=0}]"
```
ğŸ“Œ **ZmieÅ„ `AMAZON_LINUX_2` na odpowiedni system operacyjny, jeÅ›li uÅ¼ywasz innego.**  

---

### **3. Przypisanie polityki do instancji EC2**  
ğŸ“Œ Pobierz **ID polityki** Patch Manager:  
```sh
aws ssm describe-patch-baselines --query "BaselineIdentities[*].[BaselineId,Name]" --output table
```
ğŸ“Œ Przypisz politykÄ™ do instancji:  
```sh
aws ssm register-patch-baseline-for-patch-group \
    --baseline-id pb-0123456789abcdef0 \
    --patch-group "Production"
```

---

### **4. Wymuszenie aktualizacji systemu operacyjnego**
ğŸ“Œ Uruchom proces aktualizacji:  
```sh
aws ssm send-command \
    --document-name "AWS-RunPatchBaseline" \
    --targets "Key=tag:Environment,Values=Production" \
    --parameters "Operation=Install"
```

---

### **5. Sprawdzenie statusu aktualizacji**  
ğŸ“Œ Monitorowanie statusu aktualizacji:  
```sh
aws ssm list-command-invocations \
    --query "CommandInvocations[*].[CommandId,InstanceId,Status]" --output table
```
ğŸ“Œ **Gdy `Status` zmieni siÄ™ na `Success`, aktualizacja zostaÅ‚a zakoÅ„czona!** ğŸ‰  
</details>

---

## **8. Konfiguracja AWS Systems Manager Session Manager**  
- PoÅ‚Ä…cz siÄ™ do instancji EC2 za pomocÄ… Session Manager, bez potrzeby korzystania z klucza SSH.  

<details>
    <summary>Instrukcja krok po kroku AWS GUI</summary>

### **1. Upewnienie siÄ™, Å¼e instancja EC2 ma odpowiedniÄ… rolÄ™ IAM**  
1. PrzejdÅº do **AWS Management Console** â†’ **EC2**.  
2. Wybierz swojÄ… instancjÄ™ EC2 i przejdÅº do zakÅ‚adki **Security**.  
3. SprawdÅº, czy instancja ma przypisanÄ… rolÄ™ IAM.  
4. JeÅ›li brak roli IAM, utwÃ³rz nowÄ… rolÄ™:  
   - PrzejdÅº do **AWS IAM** â†’ **Roles** â†’ **Create role**.  
   - Wybierz **AWS service** â†’ **EC2**.  
   - Wyszukaj i dodaj politykÄ™: **AmazonSSMManagedInstanceCore**.  
   - Nazwij rolÄ™ np. `SSM-Session-Manager-Role` i kliknij **Create role**.  
   - WrÃ³Ä‡ do EC2 â†’ **Modify IAM role** i przypisz nowo utworzonÄ… rolÄ™ do instancji.  

ğŸ“Œ **Teraz instancja EC2 ma uprawnienia do korzystania z Systems Manager!** ğŸ‰  

---

### **2. WÅ‚Ä…czenie AWS Systems Manager Agent na instancji**  
ğŸ“Œ JeÅ›li korzystasz z **Amazon Linux 2** lub **Ubuntu**, agent jest domyÅ›lnie zainstalowany. SprawdÅº jego status:  
1. PoÅ‚Ä…cz siÄ™ do instancji (jeÅ›li masz dostÄ™p SSH).  
2. Uruchom polecenie:  
   ```sh
   sudo systemctl status amazon-ssm-agent
   ```
3. JeÅ›li agent nie jest uruchomiony, uruchom go:  
   ```sh
   sudo systemctl start amazon-ssm-agent
   ```
4. JeÅ›li nie masz zainstalowanego agenta, zainstaluj go:  
   ```sh
   sudo yum install -y amazon-ssm-agent  # Amazon Linux / RHEL
   sudo apt install -y amazon-ssm-agent  # Ubuntu / Debian
   ```

ğŸ“Œ **Agent SSM jest teraz gotowy do obsÅ‚ugi Session Managera!** ğŸ‰  

---

### **3. PoÅ‚Ä…czenie z instancjÄ… EC2 przez Session Manager**  
1. PrzejdÅº do **AWS Systems Manager** â†’ **Session Manager**.  
2. Kliknij **Start Session**.  
3. Wybierz swojÄ… instancjÄ™ EC2 i kliknij **Start Session**.  
4. Otworzy siÄ™ terminal w przeglÄ…darce, gdzie moÅ¼esz zarzÄ…dzaÄ‡ instancjÄ….  

ğŸ“Œ **Teraz moÅ¼esz zarzÄ…dzaÄ‡ instancjÄ… EC2 bez SSH!** ğŸ‰  

</details>

<details>
    <summary>Instrukcja krok po kroku AWS CLI</summary>

### **1. Sprawdzenie, czy instancja EC2 ma przypisanÄ… rolÄ™ IAM**  
```sh
aws ec2 describe-instances \
    --query "Reservations[*].Instances[*].[InstanceId,IamInstanceProfile.Arn]" --output table
```
ğŸ“Œ **JeÅ›li instancja nie ma przypisanej roli IAM, wykonaj nastÄ™pne kroki, aby dodaÄ‡ rolÄ™.**  

---

### **2. Tworzenie roli IAM dla Session Manager**  
ğŸ“Œ UtwÃ³rz rolÄ™ IAM dla EC2:  
```sh
aws iam create-role --role-name SSM-Session-Manager-Role \
    --assume-role-policy-document '{
        "Version": "2012-10-17",
        "Statement": [
            {
                "Effect": "Allow",
                "Principal": { "Service": "ec2.amazonaws.com" },
                "Action": "sts:AssumeRole"
            }
        ]
    }'
```
ğŸ“Œ Dodaj uprawnienia **AmazonSSMManagedInstanceCore** do roli:  
```sh
aws iam attach-role-policy \
    --role-name SSM-Session-Manager-Role \
    --policy-arn arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore
```
ğŸ“Œ Przypisz rolÄ™ do instancji EC2:  
```sh
aws ec2 associate-iam-instance-profile \
    --instance-id i-0123456789abcdef0 \
    --iam-instance-profile Name=SSM-Session-Manager-Role
```

---

### **3. PoÅ‚Ä…czenie do instancji EC2 przez Session Manager w CLI**  
ğŸ“Œ Aby poÅ‚Ä…czyÄ‡ siÄ™ do instancji EC2 przez AWS CLI:  
```sh
aws ssm start-session --target i-0123456789abcdef0
```
ğŸ“Œ **Teraz moÅ¼esz zarzÄ…dzaÄ‡ instancjÄ… bez SSH!** ğŸ‰  

---

### **4. Sprawdzenie aktywnych sesji w Session Manager**  
```sh
aws ssm describe-sessions --state Active
```

ğŸ“Œ **Zobaczysz listÄ™ aktywnych sesji dla swojej instancji EC2.**  

---

### **5. ZakoÅ„czenie sesji Session Manager**  
ğŸ“Œ Aby zakoÅ„czyÄ‡ sesjÄ™, uÅ¼yj:  
```sh
aws ssm terminate-session --session-id session-0a1b2c3d4e5f6g7h8
```

ğŸ“Œ **Teraz sesja zostaÅ‚a zamkniÄ™ta!** ğŸ‰  

</details>
